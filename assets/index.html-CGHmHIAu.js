import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o,c,f as t,a as n,b as a,d as s}from"./app-DCLtSmWZ.js";const l={},p=n("h2",{id:"全文概述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#全文概述"},[n("span",null,"全文概述")])],-1),i=a("<ul><li>「<strong>AJAX 全称 Asynchronous Javascript And XML</strong>」：异步JavaScript和xml，是一种技术的统称 <ul><li>「<strong>XHR 全称 XmlHttpRequest</strong>」：HTML源生实现Ajax的一种技术</li><li>「<strong>Fetch</strong>」：基于 Promise 的一种api，在es6时提出，用于代替 XHR 实现 AJAX 的一种技术</li></ul></li><li>「<strong>axios</strong>」 是一种 使用 Promise + xhr 封装的第三方库</li><li>「<strong>umi-request</strong>」： 基于 fetch 封装的第三方库</li></ul><blockquote><p><strong>上传下载进度：</strong></p><ol><li>xhr <code>支持上传、下载进度展示</code></li><li>fetch 不支持上传进度，<code>支持下载进度展示</code></li></ol><p><strong>Abort 取消机制：</strong></p><ol><li>xhr <code>支持终止请求</code></li><li>fetch <code>本身不支持</code>，可使用 <code>信号控制器 AbortController</code> 实现</li></ol><p><strong>Timeout 超时机制:</strong></p><ol><li>xhr <code>支持超时机制</code></li><li>fetch <strong>本身不支持</strong>，可使用 <code>信号控制器 AbortController</code> 以及 <code>Promise</code> 实现</li></ol></blockquote>",2),r=a(`<h2 id="如何创建ajax" tabindex="-1"><a class="header-anchor" href="#如何创建ajax"><span>如何创建Ajax</span></a></h2><ol><li>创建 <code>XMLHttpRequest</code> 对象。</li><li>使用<code>open</code>方法设置请求的参数。<code>open(method, url, 是否异步)</code></li><li>发送请求。</li><li>注册事件。 注册 <code>onreadystatechange</code> 事件，状态改变时就会调用。</li><li>获取返回的数据，更新UI。</li></ol><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">xhrRequest</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">}</span> <span class="token operator">=</span> option
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
      <span class="token keyword">return</span> xhr<span class="token punctuation">.</span>responseText
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注册 <code>onreadystatechange</code> 事件后，每当 <code>readyState</code> 属性改变时，就会调用 <code>onreadystatechange</code> 函数。</p><p><code>readyState</code>：（存有 <code>XMLHttpRequest</code> 的状态。从 0 到 4 发生变化）</p><ul><li><code>0</code>: 请求未初始化</li><li><code>1</code>: 服务器连接已建立</li><li><code>2</code>: 请求已接收</li><li><code>3</code>: 请求处理中</li><li><code>4</code>: 请求已完成，且响应已就绪</li></ul><h3 id="事件的触发条件及顺序" tabindex="-1"><a class="header-anchor" href="#事件的触发条件及顺序"><span>事件的触发条件及顺序</span></a></h3><table><thead><tr><th>顺序</th><th>事件</th><th>触发条件</th></tr></thead><tbody><tr><td>1</td><td>xhr.onreadystatechange</td><td>每当<code>xhr.readystate</code>改变时触发；但<code>xhr.readystate</code>由非<code>θ</code>值变为<code>0</code>时不触发(如<code>xhr.abort()</code>取消接口的时候)</td></tr><tr><td>2</td><td>xhr.onloadstart</td><td>调用<code>xhr.send()</code>方法后立即触发，若<code>xhr.send()</code>未被调用则不会触发此事件。</td></tr><tr><td>3</td><td>xhr.upload.onloadstart</td><td>上传阶段开始</td></tr><tr><td>4</td><td>xhr.upload.onprogress</td><td><code>xhr.upload.onprogress</code>在上传阶段(即<code>xhr.send()</code>之后，<code>xhr.readystate=2</code>之前)触发，每50ms触发一次</td></tr><tr><td>5</td><td>xhr.upload.onload</td><td></td></tr><tr><td>6</td><td>xhr.upload.onloadend</td><td>上传阶段结束，下载阶段开始</td></tr><tr><td>7</td><td>xhr.onprogress</td><td><code>xhr.onprogress</code>在下载阶段(即<code>xhr.readystate=3</code>时)触发，每50ms触发一次</td></tr><tr><td>8</td><td>xhr.onload</td><td>当请求成功完成时触发，此时 <code>xhr.readystate=4</code></td></tr><tr><td>9</td><td>xhr.onloadend</td><td>当请求结束(包括请求成功和请求失败)时触发</td></tr><tr><td></td><td>xhr.onabort</td><td>当调用 <code>xhr.abort()</code> 后触发</td></tr><tr><td></td><td>xhr.ontimeout</td><td><code>xhr.timeout</code> 不等于0，由请求开始即 <code>onloadstart</code> 开始算起，当到达 <code>xhr.timeout</code> 所设置时间请求还未结束即 <code>onloadend</code>，则触发此事件。</td></tr><tr><td></td><td>xhr.onerror</td><td>在请求过程中，若发生 <code>Network error</code> 则会触发此事件(若发生 <code>Network error</code> 时，上传还没有结束，则会先触发 <code>xhr.upload.onerror</code>，再触发 <code>xhr.onerror</code>；若发生 Network error 时，上传已经结束，则只会触发 <code>xhr.onerror</code> )。注意，只有发生了 <strong>网络层级别</strong> 的异常才会触发此事件，对于应用层级别的异常，如响应返回的 <code>xhr.statuscode</code> 是 <code>4xx</code> 时，并不属于 <code>Network error</code>，所以不会触发 <code>onerror</code> 事件，而是会触发 <code>onload</code> 事件。</td></tr></tbody></table><h2 id="progress-进度条展示" tabindex="-1"><a class="header-anchor" href="#progress-进度条展示"><span>progress 进度条展示</span></a></h2><h3 id="xhr-实现-上传、下载" tabindex="-1"><a class="header-anchor" href="#xhr-实现-上传、下载"><span>xhr 实现 上传、下载</span></a></h3>`,10),u=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{javascript:"",class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"xhrRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"option"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" url"),n("span",{class:"token punctuation"},","),s(" method "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'GET'"),n("span",{class:"token punctuation"},","),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` option
  `),n("span",{class:"token keyword"},"const"),s(" xhr "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"XMLHttpRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"onreadystatechange"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),n("span",{class:"token punctuation"},"("),s("xhr"),n("span",{class:"token punctuation"},"."),s("readyState "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"4"),s(),n("span",{class:"token operator"},"&&"),s(" xhr"),n("span",{class:"token punctuation"},"."),s("status "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"200"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'progress'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" loaded"),n("span",{class:"token punctuation"},","),s(" total "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` e
    console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("loaded"),n("span",{class:"token punctuation"},","),s(" total"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 下载的当前数据以及下载的总数据量"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  xhr`),n("span",{class:"token punctuation"},"."),s("upload"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'progress'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token parameter"},"e"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" loaded"),n("span",{class:"token punctuation"},","),s(" total "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` e
    console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("loaded"),n("span",{class:"token punctuation"},","),s(" total"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 上传的当前数据以及上传的总数据量"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"open"),n("span",{class:"token punctuation"},"("),s("method"),n("span",{class:"token punctuation"},","),s(" url"),n("span",{class:"token punctuation"},")"),s(`
  xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),d=n("h3",{id:"fetch-实现-下载",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#fetch-实现-下载"},[n("span",null,"fetch 实现 下载")])],-1),k=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{javascript:"",class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"fetchRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"option"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" url"),n("span",{class:"token punctuation"},","),s(" method "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'GET'"),n("span",{class:"token punctuation"},","),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(` option
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token parameter"},"resolve"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" resp "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"fetch"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(" method"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token literal-property property"},"body"),n("span",{class:"token operator"},":"),s(" data "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" loaded "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" total "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"+"),s("resp"),n("span",{class:"token punctuation"},"."),s("headers"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'content-length'"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" decoder "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"TextDecoder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" body "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"''"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" reader "),n("span",{class:"token operator"},"="),s(" resp"),n("span",{class:"token punctuation"},"."),s("body"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getReader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"while"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" done"),n("span",{class:"token punctuation"},","),s(" value "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s("  reader"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"read"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("done"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"break"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
      loaded `),n("span",{class:"token operator"},"+="),s(" value"),n("span",{class:"token punctuation"},"."),s(`length
      body `),n("span",{class:"token operator"},"+="),s(" decoder"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"decode"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token function"},"resolve"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=a('<h2 id="abort-取消接口" tabindex="-1"><a class="header-anchor" href="#abort-取消接口"><span>abort 取消接口</span></a></h2><h3 id="xhr-实现-abort" tabindex="-1"><a class="header-anchor" href="#xhr-实现-abort"><span>xhr 实现 abort</span></a></h3><blockquote><p>如果该请求已被发出，<strong>XMLHttpRequest.abort()</strong> 方法将终止该请求。</p><p>当一个请求被终止，它的 <strong>readyState</strong> 将被置为 <strong>XMLHttpRequest.UNSENT(0)</strong>，并且请求的 <strong>status</strong> 置为 <strong>0</strong>。</p></blockquote>',3),m=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{javascript:"",class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"xhrWithCancel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("url"),n("span",{class:"token punctuation"},","),s(" token")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"// the token is for cancellation"),s(`
   `),n("span",{class:"token keyword"},"let"),s(" xhr "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"XMLHttpRequest"),s(`
   xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"open"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'GET'"),n("span",{class:"token punctuation"},","),s(" url"),n("span",{class:"token punctuation"},")"),s(`
   `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("resolve"),n("span",{class:"token punctuation"},","),s(" reject")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"onload"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"resolve"),n("span",{class:"token punctuation"},"("),s("xhr"),n("span",{class:"token punctuation"},"."),s("responseText"),n("span",{class:"token punctuation"},")"),s(`
      token`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"cancel"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s("  "),n("span",{class:"token comment"},"// SPECIFY CANCELLATION"),s(`
        xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"abort"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// abort request"),s(`
        `),n("span",{class:"token function"},"reject"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Cancelled"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// reject the promise"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
      xhr`),n("span",{class:"token punctuation"},"."),s("onerror "),n("span",{class:"token operator"},"="),s(` reject
   `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"let"),s(" token "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"let"),s(" promise "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"xhrWithCancel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"/someUrl"'),n("span",{class:"token punctuation"},","),s(" token"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// later we want to abort the promise:"),s(`
token`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"cancel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," ")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),b=a(`<h3 id="fetch-增加-abort" tabindex="-1"><a class="header-anchor" href="#fetch-增加-abort"><span>fetch 增加 abort</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> abortController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 信号控制器</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span>signal
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  abortController<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="axios-取消接口方法" tabindex="-1"><a class="header-anchor" href="#axios-取消接口方法"><span>axios 取消接口方法</span></a></h3><div class="hint-container warning"><p class="hint-container-title">注意</p><p>2021 年 10 月推出的 <strong>Axios V0.22.0</strong> 版本中把 <strong>CancelToken</strong> 打上 <strong>deprecated</strong> 的标记，意味废弃。与此同时，推荐 <strong>AbortController</strong> 来取而代之</p></div><h2 id="timeout-超时处理" tabindex="-1"><a class="header-anchor" href="#timeout-超时处理"><span>timeout 超时处理</span></a></h2><h3 id="xhr-实现-timeout" tabindex="-1"><a class="header-anchor" href="#xhr-实现-timeout"><span>xhr 实现 timeout</span></a></h3>`,6),v=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{javascript:"",class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"let"),s(" xhr "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"XMLHttpRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
xhr`),n("span",{class:"token punctuation"},"."),s("timeout "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"2000"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 超时时间，单位是毫秒"),s(`
xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"onload"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 请求完成。在此进行处理。"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"ontimeout"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// XMLHttpRequest 超时。在此做某事。"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"open"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"GET"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"/server"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
xhr`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),g=n("h3",{id:"fetch-增加-timeout",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#fetch-增加-timeout"},[n("span",null,"fetch 增加 timeout")])],-1),x=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{javascript:"",class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"createFetchWithTimeoutByPromiseStatus"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("timeout "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5000")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("url"),n("span",{class:"token punctuation"},","),s(" options")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("resolve"),n("span",{class:"token punctuation"},","),s(" reject")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" abortController "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"AbortController"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// 信号控制器"),s(`
      `),n("span",{class:"token function"},"fetch"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token operator"},"..."),s("options"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token literal-property property"},"signal"),n("span",{class:"token operator"},":"),s(" abortController"),n("span",{class:"token punctuation"},"."),s(`signal
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),s("resolve"),n("span",{class:"token punctuation"},","),s(" reject"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token function"},"setTimeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"reject"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'fetch timeout'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
        abortController`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"abort"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(" timeout"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),f=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{javascript:"",class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"createFetchWithTimeoutByPromiseRace"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("timeout "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5000")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("url"),n("span",{class:"token punctuation"},","),s(" options")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" Promise"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"race"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),s(`
      `),n("span",{class:"token function"},"fetch"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},","),s(" options"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("resolve"),n("span",{class:"token punctuation"},","),s(" reject")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"setTimeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token function"},"reject"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'fetch timeout'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(" timeout"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function y(w,j){return o(),c("div",null,[p,t(" #region info "),i,t(" #endregion info "),r,u,d,k,h,m,b,v,g,x,f])}const _=e(l,[["render",y],["__file","index.html.vue"]]),R=JSON.parse('{"path":"/Promotion/JavaScript/AJAX/","title":"AJAX - XHR与Fetch","lang":"zh-CN","frontmatter":{"title":"AJAX - XHR与Fetch","lang":"zh-CN","date":"2024-05-07T16:31:31.000Z","permalink":"/Promotion/JavaScript/AJAX/","headerDepth":3,"description":"全文概述 「AJAX 全称 Asynchronous Javascript And XML」：异步JavaScript和xml，是一种技术的统称 「XHR 全称 XmlHttpRequest」：HTML源生实现Ajax的一种技术 「Fetch」：基于 Promise 的一种api，在es6时提出，用于代替 XHR 实现 AJAX 的一种技术 「axio...","head":[["meta",{"property":"og:url","content":"https://shaohui-jin.github.io/Promotion/JavaScript/AJAX/"}],["meta",{"property":"og:title","content":"AJAX - XHR与Fetch"}],["meta",{"property":"og:description","content":"全文概述 「AJAX 全称 Asynchronous Javascript And XML」：异步JavaScript和xml，是一种技术的统称 「XHR 全称 XmlHttpRequest」：HTML源生实现Ajax的一种技术 「Fetch」：基于 Promise 的一种api，在es6时提出，用于代替 XHR 实现 AJAX 的一种技术 「axio..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-17T09:45:20.000Z"}],["meta",{"property":"article:author","content":"石怜安"}],["meta",{"property":"article:published_time","content":"2024-05-07T16:31:31.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-17T09:45:20.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"AJAX - XHR与Fetch\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-05-07T16:31:31.000Z\\",\\"dateModified\\":\\"2025-04-17T09:45:20.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"石怜安\\",\\"url\\":\\"https://shaohui-jin.github.io\\"}]}"]]},"headers":[{"level":2,"title":"全文概述","slug":"全文概述","link":"#全文概述","children":[]},{"level":2,"title":"如何创建Ajax","slug":"如何创建ajax","link":"#如何创建ajax","children":[{"level":3,"title":"事件的触发条件及顺序","slug":"事件的触发条件及顺序","link":"#事件的触发条件及顺序","children":[]}]},{"level":2,"title":"progress 进度条展示","slug":"progress-进度条展示","link":"#progress-进度条展示","children":[{"level":3,"title":"xhr 实现 上传、下载","slug":"xhr-实现-上传、下载","link":"#xhr-实现-上传、下载","children":[]},{"level":3,"title":"fetch 实现 下载","slug":"fetch-实现-下载","link":"#fetch-实现-下载","children":[]}]},{"level":2,"title":"abort 取消接口","slug":"abort-取消接口","link":"#abort-取消接口","children":[{"level":3,"title":"xhr 实现 abort","slug":"xhr-实现-abort","link":"#xhr-实现-abort","children":[]},{"level":3,"title":"fetch 增加 abort","slug":"fetch-增加-abort","link":"#fetch-增加-abort","children":[]},{"level":3,"title":"axios 取消接口方法","slug":"axios-取消接口方法","link":"#axios-取消接口方法","children":[]}]},{"level":2,"title":"timeout 超时处理","slug":"timeout-超时处理","link":"#timeout-超时处理","children":[{"level":3,"title":"xhr 实现 timeout","slug":"xhr-实现-timeout","link":"#xhr-实现-timeout","children":[]},{"level":3,"title":"fetch 增加 timeout","slug":"fetch-增加-timeout","link":"#fetch-增加-timeout","children":[]}]}],"git":{"createdTime":1744883120000,"updatedTime":1744883120000,"contributors":[{"name":"shaohui_jin","email":"1051131737@qq.com","commits":1}]},"readingTime":{"minutes":4.08,"words":1225},"filePathRelative":"zh/精选文章/JavaScript/网络/AJAX - XHR与Fetch.md","localizedDate":"2024年5月7日","excerpt":"<h2>全文概述</h2>\\n<!-- #region info -->\\n<ul>\\n<li>「<strong>AJAX 全称 Asynchronous Javascript And XML</strong>」：异步JavaScript和xml，是一种技术的统称\\n<ul>\\n<li>「<strong>XHR 全称 XmlHttpRequest</strong>」：HTML源生实现Ajax的一种技术</li>\\n<li>「<strong>Fetch</strong>」：基于 Promise 的一种api，在es6时提出，用于代替 XHR 实现 AJAX 的一种技术</li>\\n</ul>\\n</li>\\n<li>「<strong>axios</strong>」 是一种 使用 Promise + xhr 封装的第三方库</li>\\n<li>「<strong>umi-request</strong>」： 基于 fetch 封装的第三方库</li>\\n</ul>","autoDesc":true}');export{_ as comp,R as data};
