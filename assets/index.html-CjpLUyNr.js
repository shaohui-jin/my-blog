import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as e,o as l,c as i,a as n,f as s,e as p,d as u,b as a}from"./app-DM2oBLF-.js";const r={},d=a('<h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€"><span>å‰è¨€</span></a></h2><p><code>Webpack</code>åœ¨å‰ç«¯æ„å»ºå·¥å…·ä¸­å¯ä»¥å ªç§°ä¸­æµç ¥æŸ±èˆ¬çš„å­˜åœ¨ï¼Œæ—¥å¸¸ä¸šåŠ¡å¼€å‘ã€å‰ç«¯åŸºå»ºå·¥å…·ã€é«˜çº§å‰ç«¯é¢è¯•...ä»»ä½•åœºæ™¯éƒ½ä¼šå‡ºç°å®ƒçš„èº«å½±ã€‚</p><p>ä¹Ÿè®¸å¯¹äºå®ƒçš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šæ„Ÿåˆ°ç–‘æƒ‘ï¼Œæ—¥å¸¸å·¥ä½œä¸­åŸºäº<code>Webpack Plugin/Loader</code>ä¹‹ç±»æŸ¥é˜…<code>API</code>ä»ç„¶ä¸æ˜ç™½å„ä¸ªå‚æ•°çš„å«ä¹‰å’Œåº”ç”¨æ–¹å¼ã€‚å…¶å®è¿™ä¸€åˆ‡åŸå› æœ¬è´¨ä¸Šéƒ½æ˜¯åŸºäº<code>Webpack</code>å·¥ä½œæµæ²¡æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤çŸ¥å¯¼è‡´äº†æ‰€è°“çš„â€œé¢å¯¹<code>API</code>æ— ä»ä¸‹æ‰‹â€å¼€å‘ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¼šä»å¦‚ä½•å®ç° <strong>æ¨¡å—åˆ†æé¡¹ç›®æ‰“åŒ…</strong> çš„è§’åº¦å‡ºå‘ï¼Œä½¿ç”¨ <strong>æœ€é€šä¿—ï¼Œæœ€ç®€æ´ï¼Œæœ€æ˜äº†</strong> çš„ä»£ç å¸¦ä½ æ­å¼€<code>Webpack</code>èƒŒåçš„ç¥ç§˜é¢çº±ï¼Œå¸¦ä½ å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆ<code>Webpack</code>ï¼Œä»æ­¤å¯¹äºä»»ä½•<code>webpack</code>ç›¸å…³åº•å±‚å¼€å‘äº†ç„¶äºèƒ¸ã€‚ç”¨æœ€é€šä¿—æ˜“æ‡‚çš„ä»£ç å¸¦ä½ èµ°è¿›<code>webpack</code>çš„å·¥ä½œæµã€‚</p>',4),k={href:"https://gitee.com/jin-shaohui/webpack-demo",target:"_blank",rel:"noopener noreferrer"},m=a('<h2 id="å‰ç½®çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#å‰ç½®çŸ¥è¯†"><span>å‰ç½®çŸ¥è¯†</span></a></h2><ul><li><p><strong>Tapable</strong></p><p>TapableåŒ…æœ¬è´¨ä¸Šæ˜¯ä¸ºæˆ‘ä»¬æ›´æ–¹é¢åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶å’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶çš„åº“ï¼Œç±»ä¼¼äº<code>Nodejs</code>ä¸­çš„<code>EventEmitter Api</code>ã€‚<code>Webpack</code>ä¸­çš„æ’ä»¶æœºåˆ¶å°±æ˜¯åŸºäºTapableå®ç°ä¸æ‰“åŒ…æµç¨‹è§£è€¦ï¼Œæ’ä»¶çš„æ‰€æœ‰å½¢å¼éƒ½æ˜¯åŸºäº<code>Tapable</code>å®ç°ã€‚</p></li><li><p><strong>Webpack Node Api</strong></p><p>åŸºäºå­¦ä¹ ç›®çš„ï¼Œä¼šç€é‡äº<code>Webpack Node Api</code>æµç¨‹å»è®²è§£ï¼Œå®é™…ä¸Šå‰ç«¯æ—¥å¸¸ä½¿ç”¨çš„<code>npm run build</code>å‘½ä»¤ä¹Ÿæ˜¯é€šè¿‡ç¯å¢ƒå˜é‡è°ƒç”¨<code>bin</code>è„šæœ¬å»è°ƒç”¨<code>Node Api</code>å»æ‰§è¡Œç¼–è¯‘æ‰“åŒ…ã€‚</p></li><li><p><strong>Babel</strong></p><p><code>Webpack</code>å†…éƒ¨çš„<code>AST</code>åˆ†æåŒæ ·ä¾èµ–äº<code>Babel</code>è¿›è¡Œå¤„ç†ï¼Œå¦‚æœä½ å¯¹<code>Babel</code>ä¸æ˜¯å¾ˆç†Ÿæ‚‰ã€‚å»ºè®®å¯ä»¥å…ˆå»é˜…è¯»ä¸‹è¿™ä¸¤ç¯‡æ–‡ç«  <strong>ã€Œå‰ç«¯åŸºå»ºã€å¸¦ä½ åœ¨Babelçš„ä¸–ç•Œä¸­ç•…æ¸¸</strong>ã€<strong>ä»Tree Shakingæ¥èµ°è¿›Babelæ’ä»¶å¼€å‘è€…çš„ä¸–ç•Œ</strong>ã€‚</p></li></ul><blockquote><p>å½“ç„¶åç»­ä¹Ÿä¼šå»è¯¦è§£è¿™äº›å†…å®¹åœ¨<code>Webpack</code>ä¸­çš„åº”ç”¨ï¼Œä½†æ˜¯æˆ‘æ›´åŠ å¸Œæœ›åœ¨é˜…è¯»æ–‡ç« ä¹‹å‰ä½ å¯ä»¥å»ç‚¹ä¸€ç‚¹ä¸Šæ–¹çš„æ–‡æ¡£ç¨å¾®äº†è§£ä¸€ä¸‹å‰ç½®çŸ¥è¯†ã€‚</p></blockquote><h2 id="æµç¨‹æ¢³ç†" tabindex="-1"><a class="header-anchor" href="#æµç¨‹æ¢³ç†"><span>æµç¨‹æ¢³ç†</span></a></h2><p>åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬å…ˆå¯¹äºæ•´ä¸ªæ‰“åŒ…æµç¨‹è¿›è¡Œä¸€æ¬¡æ¢³ç†ã€‚è¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªå…¨æµç¨‹çš„æ¢³ç†ï¼Œç°åœ¨æ²¡æœ‰å¿…è¦éå¸¸è¯¦ç»†çš„å»æ€è€ƒæ¯ä¸€ä¸ªæ­¥éª¤å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­å»ä¸€æ­¥ä¸€æ­¥å¸¦ä½ ä¸²è”å®ƒä»¬ã€‚</p>',5),v=a(`<p>æ•´ä½“å°†ä¼šä»ä¸Šè¾¹5ä¸ªæ–¹é¢æ¥åˆ†æ<code>Webpack</code>æ‰“åŒ…æµç¨‹:</p><ol><li><p>åˆå§‹åŒ–å‚æ•°é˜¶æ®µ</p><p>è¿™ä¸€æ­¥ä¼šä»é…ç½®çš„<code>webpack.config.js</code>ä¸­è¯»å–åˆ°å¯¹åº”çš„é…ç½®å‚æ•°å’Œ<code>shell</code>å‘½ä»¤ä¸­ä¼ å…¥çš„å‚æ•°è¿›è¡Œåˆå¹¶å¾—åˆ°æœ€ç»ˆæ‰“åŒ…é…ç½®å‚æ•°ã€‚</p></li><li><p>å¼€å§‹ç¼–è¯‘å‡†å¤‡é˜¶æ®µ</p><p>è¿™ä¸€æ­¥æˆ‘ä»¬ä¼šé€šè¿‡è°ƒç”¨<code>webpack()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>compiler</code>æ–¹æ³•ï¼Œåˆ›å»ºæˆ‘ä»¬çš„<code>compiler</code>å¯¹è±¡ï¼Œå¹¶ä¸”æ³¨å†Œå„ä¸ª<code>Webpack Plugin</code>ã€‚æ‰¾åˆ°é…ç½®å…¥å£ä¸­çš„<code>entry</code>ä»£ç ï¼Œè°ƒç”¨<code>compiler.run()</code>æ–¹æ³•è¿›è¡Œç¼–è¯‘ã€‚</p></li><li><p>æ¨¡å—ç¼–è¯‘é˜¶æ®µ</p><p>ä»å…¥å£æ¨¡å—è¿›è¡Œåˆ†æï¼Œè°ƒç”¨åŒ¹é…æ–‡ä»¶çš„<code>loaders</code>å¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚åŒæ—¶åˆ†ææ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œé€’å½’è¿›è¡Œæ¨¡å—ç¼–è¯‘å·¥ä½œã€‚</p></li><li><p>å®Œæˆç¼–è¯‘é˜¶æ®µ</p><p>åœ¨é€’å½’å®Œæˆåï¼Œæ¯ä¸ªå¼•ç”¨æ¨¡å—é€šè¿‡<code>loaders</code>å¤„ç†å®ŒæˆåŒæ—¶å¾—åˆ°æ¨¡å—ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ã€‚</p></li><li><p>è¾“å‡ºæ–‡ä»¶é˜¶æ®µ</p><p>æ•´ç†æ¨¡å—ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶å°†å¤„ç†åçš„æ–‡ä»¶è¾“å‡ºåˆ°<code>ouput</code>çš„ç£ç›˜ç›®å½•ä¸­ã€‚ d</p></li></ol><h2 id="åˆ›å»ºç›®å½•" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç›®å½•"><span>åˆ›å»ºç›®å½•</span></a></h2><p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚é¦–å…ˆè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‰¯å¥½çš„ç›®å½•æ¥ç®¡ç†æˆ‘ä»¬éœ€è¦å®ç°çš„<code>Packing tool</code>å§ï¼</p><p>è®©æˆ‘ä»¬æ¥åˆ›å»ºè¿™æ ·ä¸€ä¸ªç›®å½•:</p><figure><img src="https://shaohui-jin.github.io/picx-images-hosting/blog/Webpack/fileDirectory.77dbfxn0wu.webp" alt="" width="800" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="åˆå§‹åŒ–å‚æ•°é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–å‚æ•°é˜¶æ®µ"><span>åˆå§‹åŒ–å‚æ•°é˜¶æ®µ</span></a></h2><p>å¾€å¾€ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸ä½¿ç”¨é˜¶æ®µæœ‰ä¸¤ç§æ–¹å¼å»ç»™<code>webpack</code>ä¼ é€’æ‰“åŒ…å‚æ•°ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä¼ é€’å‚æ•°:</p><h3 id="cliå‘½ä»¤è¡Œä¼ é€’å‚æ•°" tabindex="-1"><a class="header-anchor" href="#cliå‘½ä»¤è¡Œä¼ é€’å‚æ•°"><span><code>Cli</code>å‘½ä»¤è¡Œä¼ é€’å‚æ•°</span></a></h3><p>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è°ƒç”¨<code>webpack</code>å‘½ä»¤æ—¶ï¼Œæœ‰æ—¶ä¼šä¼ å…¥ä¸€å®šå‘½ä»¤è¡Œå‚æ•°ï¼Œæ¯”å¦‚:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>webpack <span class="token parameter variable">--mode</span><span class="token operator">=</span>production
<span class="token comment"># è°ƒç”¨webpackå‘½ä»¤æ‰§è¡Œæ‰“åŒ… åŒæ—¶ä¼ å…¥modeä¸ºproduction</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="webpack-config-jsä¼ é€’å‚æ•°" tabindex="-1"><a class="header-anchor" href="#webpack-config-jsä¼ é€’å‚æ•°"><span><code>webpack.config.js</code>ä¼ é€’å‚æ•°</span></a></h3><p>å¦ä¸€ç§æ–¹å¼ï¼Œæˆ‘ç›¸ä¿¡å°±æ›´åŠ è€ç”Ÿå¸¸è°ˆäº†ã€‚</p><p>æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ä½¿ç”¨<code>webpack.config.js</code>å¯¼å‡ºä¸€ä¸ªå¯¹è±¡è¿›è¡Œ<code>webpack</code>é…ç½®:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Plugin1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./plugins/plugin1&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Plugin2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./plugins/plugin2&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src/entry1.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">second</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src/entry2.js&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// åŸºç¡€ç›®å½•ï¼Œç»å¯¹è·¯å¾„ï¼Œç”¨äºä»é…ç½®ä¸­è§£æå…¥å£ç‚¹(entry point)å’Œ åŠ è½½å™¨(loader)ã€‚æ¢è€Œè¨€ä¹‹entryå’Œloaderçš„æ‰€æœ‰ç›¸å¯¹è·¯å¾„éƒ½æ˜¯ç›¸å¯¹äºè¿™ä¸ªè·¯å¾„è€Œè¨€çš„</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./build&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Plugin1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Plugin2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.vue&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./loaders/loader1.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./loaders/loader2.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å½“ç„¶è¿™é‡Œçš„<code>loader</code>å’Œ<code>plugin</code>ç›®å‰ä½ å¯ä»¥ä¸ç”¨ç†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šé€æ­¥å®ç°è¿™äº›ä¸œè¥¿å¹¶ä¸”æ·»åŠ åˆ°æˆ‘ä»¬çš„æ‰“åŒ…æµç¨‹ä¸­å»ã€‚</p></blockquote><h3 id="å®ç°åˆå¹¶å‚æ•°é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#å®ç°åˆå¹¶å‚æ•°é˜¶æ®µ"><span>å®ç°åˆå¹¶å‚æ•°é˜¶æ®µ</span></a></h3><p>è¿™ä¸€æ­¥ï¼Œè®©æˆ‘ä»¬çœŸæ­£å¼€å§‹åŠ¨æ‰‹å®ç°æˆ‘ä»¬çš„<code>webpack</code>å§ï¼</p><p>é¦–å…ˆè®©æˆ‘ä»¬åœ¨<code>webpack/core</code>ä¸‹æ–°å»ºä¸€ä¸ª<code>index.js</code>æ–‡ä»¶ä½œä¸ºæ ¸å¿ƒå…¥å£æ–‡ä»¶ã€‚</p><p>åŒæ—¶å»ºç«‹ä¸€ä¸ª<code>webpack/core</code>ä¸‹æ–°å»ºä¸€ä¸ª<code>webpack.js</code>æ–‡ä»¶ä½œä¸º<code>webpack()</code>æ–¹æ³•çš„å®ç°æ–‡ä»¶ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¸…æ¥šåœ¨<code>NodeJs Api</code>ä¸­æ˜¯é€šè¿‡<code>webpack()</code>æ–¹æ³•å»å¾—åˆ°<code>compiler</code>å¯¹è±¡çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> compiler <span class="token operator">=</span>  <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> status</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">closeErr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶è®©æˆ‘ä»¬æŒ‰ç…§åŸæœ¬çš„<code>webpack</code>æ¥å£æ ¼å¼æ¥è¡¥å……ä¸€ä¸‹<code>index.js</code>ä¸­çš„é€»è¾‘:</p><ul><li>æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<code>webpack</code>æ–¹æ³•å»æ‰§è¡Œè°ƒç”¨å‘½ä»¤ã€‚</li><li>åŒæ—¶æˆ‘ä»¬å¼•å…¥<code>webpack.config.js</code>é…ç½®æ–‡ä»¶ä¼ å…¥<code>webpack</code>æ–¹æ³•ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../example/webpack.config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ­¥éª¤1: åˆå§‹åŒ–å‚æ•° æ ¹æ®é…ç½®æ–‡ä»¶å’Œshellå‚æ•°åˆæˆå‚æ•°</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å—¯ï¼Œçœ‹èµ·æ¥è¿˜ä¸é”™ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬å»å®ç°ä¸€ä¸‹<code>webpack.js</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆå¹¶å‚æ•° å¾—åˆ°åˆå¹¶åçš„å‚æ•° mergeOptions</span>
  <span class="token keyword">const</span> mergeOption <span class="token operator">=</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆå¹¶é…ç½®å‚æ•°</span>
<span class="token keyword">function</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> shellOption <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">option<span class="token punctuation">,</span> argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> argv<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;=&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> parseKey <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
      option<span class="token punctuation">[</span>parseKey<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> option
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>options<span class="token punctuation">,</span> <span class="token operator">...</span>shellOption<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpack<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢å¤–è¯´æ˜çš„æ˜¯</p><p><code>webpack</code>æ–‡ä»¶ä¸­éœ€è¦å¯¼å‡ºä¸€ä¸ªåä¸º<code>webpack</code>çš„æ–¹æ³•ï¼ŒåŒæ—¶æ¥å—å¤–éƒ¨ä¼ å…¥çš„é…ç½®å¯¹è±¡ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬åœ¨ä¸Šè¿°è®²è¿°è¿‡çš„ã€‚</p><p>å½“ç„¶å…³äºæˆ‘ä»¬åˆå¹¶å‚æ•°çš„é€»è¾‘ï¼Œæ˜¯å°†<strong>å¤–éƒ¨ä¼ å…¥çš„å¯¹è±¡å’Œæ‰§è¡Œ<code>shell</code>æ—¶çš„ä¼ å…¥å‚æ•°è¿›è¡Œæœ€ç»ˆåˆå¹¶</strong>ã€‚</p><p>åœ¨<code>Node Js</code>ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>process.argv.slice(2)</code>æ¥è·å¾—<code>shell</code>å‘½ä»¤ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œæ¯”å¦‚:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// core/index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Terminal</span>
<span class="token constant">C</span><span class="token operator">:</span>\\Users\\Administrator\\Desktop\\webpack<span class="token operator">-</span>demo<span class="token operator">&gt;</span>node core<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token operator">--</span>mode<span class="token operator">=</span>production <span class="token operator">--</span>devtool<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token punctuation">[</span> <span class="token string">&#39;--mode=production&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;--devtool=false&#39;</span> <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ç„¶<code>_mergeOptions</code>æ–¹æ³•å°±æ˜¯ä¸€ä¸ªç®€å•çš„åˆå¹¶é…ç½®å‚æ•°çš„æ–¹æ³•ï¼Œç›¸ä¿¡å¯¹äºå¤§å®¶æ¥è¯´å°±æ˜¯å°èœä¸€ç¢Ÿã€‚</p><p>æ­å–œå¤§å®¶ğŸ‰ï¼Œåƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹ã€‚<strong>è¿™ä¸€æ­¥æˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰“åŒ…æµç¨‹ä¸­çš„ç¬¬ä¸€æ­¥ï¼šåˆå¹¶é…ç½®å‚æ•°</strong>ã€‚</p><h2 id="ç¼–è¯‘é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#ç¼–è¯‘é˜¶æ®µ"><span>ç¼–è¯‘é˜¶æ®µ</span></a></h2><p>åœ¨å¾—åˆ°æœ€ç»ˆçš„é…ç½®å‚æ•°ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>webpack()</code>å‡½æ•°ä¸­åšä»¥ä¸‹å‡ ä»¶äº‹æƒ…:</p><ul><li>é€šè¿‡å‚æ•°åˆ›å»º<code>compiler</code>å¯¹è±¡ã€‚æˆ‘ä»¬çœ‹åˆ°å®˜æ–¹æ¡ˆä¾‹ä¸­é€šè¿‡è°ƒç”¨<code>webpack(options)</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª<code>compiler</code>å¯¹è±¡ã€‚å¹¶ä¸”åŒæ—¶è°ƒç”¨<code>compiler.run()</code>æ–¹æ³•å¯åŠ¨çš„ä»£ç è¿›è¡Œæ‰“åŒ…ã€‚</li><li>æ³¨å†Œæˆ‘ä»¬å®šä¹‰çš„<code>webpack plugin</code>æ’ä»¶ã€‚</li><li>æ ¹æ®ä¼ å…¥çš„é…ç½®å¯¹è±¡å¯»æ‰¾å¯¹åº”çš„æ‰“åŒ…å…¥å£æ–‡ä»¶ã€‚</li></ul><h3 id="åˆ›å»ºcompilerå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºcompilerå¯¹è±¡"><span>åˆ›å»º<code>compiler</code>å¯¹è±¡</span></a></h3><p>è®©æˆ‘ä»¬å…ˆæ¥å®Œæˆ<code>index.js</code>ä¸­çš„é€»è¾‘ä»£ç è¡¥å…¨:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>const webpack = require(&#39;./webpack&#39;);

const config = require(&#39;../example/webpack.config&#39;);

/**
 * åˆå§‹åŒ–å‚æ•° æ ¹æ®é…ç½®æ–‡ä»¶å’Œshellå‚æ•°åˆæˆå‚æ•°
 * è°ƒç”¨ Webpack(options) åˆå§‹åŒ–compilerå¯¹è±¡
 * webpack()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªcompilerå¯¹è±¡
 * */
const compiler = webpack(config);

/**
 * è°ƒç”¨runæ–¹æ³•è¿›è¡Œæ‰“åŒ…
 * */
compiler.run((err, status) =&gt; {
  if(err) {
    console.log(err)
  }
  // ...
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒç¼–è¯‘å®ç°åœ¨äº<code>webpack()</code>æ–¹æ³•è¿”å›çš„<code>compiler.run()</code>æ–¹æ³•ä¸Šã€‚</p><p>ä¸€æ­¥ä¸€æ­¥è®©æˆ‘ä»¬æ¥å®Œå–„è¿™ä¸ª<code>webpack()</code>æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆå¹¶å‚æ•° å¾—åˆ°åˆå¹¶åçš„å‚æ•° mergeOptions</span>
  <span class="token keyword">const</span> mergeOption <span class="token operator">=</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token comment">// åˆ›å»º compiler å¯¹è±¡ </span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>mergeOption<span class="token punctuation">)</span>
  <span class="token keyword">return</span> compiler
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®©æˆ‘ä»¬åœ¨<code>webpack/core</code>ç›®å½•ä¸‹åŒæ ·æ–°å»ºä¸€ä¸ª<code>compiler.js</code>æ–‡ä»¶ï¼Œä½œä¸º<code>compiler</code>çš„æ ¸å¿ƒå®ç°æ–‡ä»¶:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler ç±»è¿›è¡Œæ ¸å¿ƒç¼–è¯‘å®ç°
 */</span>

<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
  <span class="token punctuation">}</span>

  <span class="token comment">// runæ–¹æ³•å¯åŠ¨ç¼–è¯‘, åŒæ—¶runæ–¹æ³•æ¥å—å¤–éƒ¨ä¼ é€’çš„callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶æˆ‘ä»¬çš„<code>Compiler</code>ç±»å°±å…ˆæ­å»ºä¸€ä¸ªåŸºç¡€çš„éª¨æ¶ä»£ç ã€‚</p><p>ç›®å‰ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†:</p><ul><li><code>webpack/core/index.js</code>ä½œä¸ºæ‰“åŒ…å‘½ä»¤çš„å…¥å£æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¼•ç”¨äº†æˆ‘ä»¬è‡ªå·±å®ç°çš„<code>webpack</code>ï¼ŒåŒæ—¶å¼•ç”¨äº†å¤–éƒ¨çš„<code>webpack.config.js(options)</code>ã€‚è°ƒç”¨<code>webpack(options).run()</code>å¼€å§‹ç¼–è¯‘ã€‚</li><li><code>webpack/core/webpack.js</code>è¿™ä¸ªæ–‡ä»¶ç›®å‰å¤„ç†äº†å‚æ•°çš„åˆå¹¶ä»¥åŠä¼ å…¥åˆå¹¶åçš„å‚æ•°<code>new Compiler(mergeOptions)</code>ï¼ŒåŒæ—¶è¿”å›åˆ›å»ºçš„<code>Compiler</code>å®åŠ›å¯¹è±¡ã€‚</li><li><code>webpack/core/compiler</code>ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„<code>compiler</code>ä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªåŸºç¡€çš„éª¨æ¶ï¼Œå­˜åœ¨ä¸€ä¸ª<code>run()</code>å¯åŠ¨æ–¹æ³•ã€‚</li></ul><h3 id="ç¼–å†™plugin" tabindex="-1"><a class="header-anchor" href="#ç¼–å†™plugin"><span>ç¼–å†™<code>Plugin</code></span></a></h3><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨<code>webpack.config.js</code>ä¸­ä½¿ç”¨äº†ä¸¤ä¸ª<code>plugin</code>---<code>pluginA</code>ã€<code>pluginB</code>æ’ä»¶å—ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥ä¾æ¬¡å®ç°å®ƒä»¬:</p><p>åœ¨å®ç°<code>Plugin</code>å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¥å®Œå–„ä¸€ä¸‹<code>compiler</code>æ–¹æ³•:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler ç±»è¿›è¡Œæ ¸å¿ƒç¼–è¯‘å®ç°
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
    <span class="token comment">// åˆ›å»ºpluginçš„hooks</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¼€å§‹ç¼–è¯‘çš„hook</span>
      <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// è¾“å‡º asset åˆ° output ç›®å½•ä¹‹å‰çš„hookï¼Œ å³å†™å…¥æ–‡ä»¶ä¹‹å‰</span>
      <span class="token literal-property property">emit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// åœ¨ compilation å®Œæˆæ—¶æ‰§è¡Œ å…¨éƒ¨å®Œæˆç¼–è¯‘æ‰§è¡Œ</span>
      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// runæ–¹æ³•å¯åŠ¨ç¼–è¯‘, åŒæ—¶runæ–¹æ³•æ¥å—å¤–éƒ¨ä¼ é€’çš„callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨<code>Compiler</code>è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºäº†ä¸€ä¸ªå±æ€§<code>hooks</code>ï¼Œå®ƒçš„å€¼æ˜¯ä¸‰ä¸ªå±æ€§<code>run</code>ã€<code>emit</code>ã€<code>done</code>ã€‚</p><p>å…³äºè¿™ä¸‰ä¸ªå±æ€§çš„å€¼å°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡æåˆ°å‰ç½®çŸ¥è¯†çš„<code>tapable</code>çš„<code>SyncHook</code>æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šä½ å¯ä»¥ç®€å•å°†<code>SyncHook()</code>æ–¹æ³•ç†è§£ç§°ä¸ºä¸€ä¸ª<code>Emitter Event</code>ç±»ã€‚</p><p>å½“æˆ‘ä»¬é€šè¿‡<code>new SyncHook()</code>è¿”å›ä¸€ä¸ªå¯¹è±¡å®ä¾‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>this.hook.run.tap(&#39;name&#39;,callback)</code>æ–¹æ³•ä¸ºè¿™ä¸ªå¯¹è±¡ä¸Šæ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œç„¶ååœ¨é€šè¿‡<code>this.hook.run.call()</code>æ‰§è¡Œæ‰€æœ‰<code>tap</code>æ³¨å†Œçš„äº‹ä»¶ã€‚</p><blockquote><p>å½“ç„¶<code>webpack</code>çœŸå®æºç ä¸­ï¼Œè¿™é‡Œæœ‰éå¸¸å¤šçš„<code>hook</code>ã€‚ä»¥åŠåˆ†åˆ«å­˜åœ¨åŒæ­¥/å¼‚æ­¥é’©å­ï¼Œè¿™é‡Œæ›´å¤šçš„æ˜¯ä¸ºå¤§å®¶è®²è§£æ¸…æ¥šæµç¨‹ï¼Œæ‰€ä»¥ä»…åˆ—ä¸¾äº†ä¸‰ä¸ªå¸¸è§ä¸”ç®€å•çš„åŒæ­¥é’©å­ã€‚</p></blockquote><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç™½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Compiler</code>ç±»è¿”å›çš„å®ä¾‹å¯¹è±¡ä¸Š<code>compiler.hooks.run.tap</code>æ³¨å†Œé’©å­ã€‚</p><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬åˆ‡å›åˆ°<code>webpack.js</code>ä¸­ï¼Œè®©æˆ‘ä»¬æ¥å¡«å……å…³äºæ’ä»¶æ³¨å†Œçš„é€»è¾‘:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> Compiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./compiler&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆå¹¶å‚æ•° å¾—åˆ°åˆå¹¶åçš„å‚æ•° mergeOptions</span>
  <span class="token keyword">const</span> mergeOption <span class="token operator">=</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token comment">// åˆ›å»º compiler å¯¹è±¡</span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>mergeOption<span class="token punctuation">)</span>
  <span class="token comment">// åŠ è½½æ’ä»¶</span>
  <span class="token function">_loadPlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span>

  <span class="token keyword">return</span> compiler
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * åˆå¹¶é…ç½®å‚æ•°
 * */</span>
<span class="token keyword">function</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> shellOption <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">option<span class="token punctuation">,</span> argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> argv<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;=&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> parseKey <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
      option<span class="token punctuation">[</span>parseKey<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> option
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>options<span class="token punctuation">,</span> <span class="token operator">...</span>shellOption<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * åŠ è½½æ’ä»¶å‡½æ•°
 * */</span>
<span class="token keyword">function</span> <span class="token function">_loadPlugin</span><span class="token punctuation">(</span><span class="token parameter">plugins<span class="token punctuation">,</span> compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpack<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬åœ¨åˆ›å»ºå®Œæˆ<code>compiler</code>å¯¹è±¡åï¼Œè°ƒç”¨äº†<code>_loadPlugin</code>æ–¹æ³•è¿›è¡Œ<strong>æ³¨å†Œæ’ä»¶</strong>ã€‚</p><p>æœ‰æ¥è§¦è¿‡<code>webpack</code>æ’ä»¶å¼€å‘çš„åŒå­¦ï¼Œæˆ–å¤šæˆ–å°‘å¯èƒ½éƒ½æœ‰äº†è§£è¿‡ã€‚<strong>ä»»ä½•ä¸€ä¸ª<code>webpack</code>æ’ä»¶éƒ½æ˜¯ä¸€ä¸ªç±»(å½“ç„¶ç±»æœ¬è´¨ä¸Šéƒ½æ˜¯funcitonçš„è¯­æ³•ç³–)ï¼Œæ¯ä¸ªæ’ä»¶éƒ½å¿…é¡»å­˜åœ¨ä¸€ä¸ª<code>apply</code>æ–¹æ³•</strong>ã€‚</p><p>è¿™ä¸ª<code>apply</code>æ–¹æ³•ä¼šæ¥å—ä¸€ä¸ª<code>compiler</code>å¯¹è±¡ã€‚æˆ‘ä»¬ä¸Šè¾¹åšçš„å°±æ˜¯ä¾æ¬¡è°ƒç”¨ä¼ å…¥çš„<code>plugin</code>çš„<code>apply</code>æ–¹æ³•å¹¶ä¸”ä¼ å…¥æˆ‘ä»¬çš„<code>compiler</code>å¯¹è±¡ã€‚</p><blockquote><p><strong>è¿™é‡Œè¯·è®°ä½ä¸Šè¾¹çš„æµç¨‹ï¼Œæ—¥å¸¸æˆ‘ä»¬ç¼–å†™<code>webpack plugin</code>æ—¶æœ¬è´¨ä¸Šå°±æ˜¯æ“ä½œ<code>compiler</code>å¯¹è±¡ä»è€Œå½±å“æ‰“åŒ…ç»“æœè¿›è¡Œã€‚</strong></p></blockquote><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å»ç¼–å†™è¿™äº›ä¸ªæ’ä»¶:</p><p>ä¸äº†è§£æ’ä»¶å¼€å‘çš„åŒå­¦å¯ä»¥å»ç¨å¾®çœ‹ä¸€ä¸‹<strong>å®˜æ–¹çš„ä»‹ç»</strong>ï¼Œå…¶å®ä¸æ˜¯å¾ˆéš¾ï¼Œå¼ºçƒˆå»ºè®®å¦‚æœä¸äº†è§£å¯ä»¥å…ˆå»çœ‹çœ‹å†å›æ¥ç»“åˆä¸Šå˜è®²çš„å†…å®¹ä½ ä¸€å®šä¼šæœ‰æ‰€æ”¶è·çš„ã€‚</p><p>é¦–å…ˆè®©æˆ‘ä»¬å…ˆåˆ›å»ºæ–‡ä»¶ï¼ˆplugin1.jsã€plugin2.jsï¼‰:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Plugin1</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ³¨å†ŒåŒæ­¥çš„é’©å­</span>
    <span class="token comment">// è¿™é‡Œçš„ compiler å¯¹è±¡å°±æ˜¯æˆ‘ä»¬ new Compiler() åˆ›å»ºçš„å®ä¾‹</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;Plugin 1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è°ƒç”¨</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ³¨å†Œæ’ä»¶ Plugin 1&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Plugin1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Plugin2</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;Plugin 2&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è°ƒç”¨</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ³¨å†Œæ’ä»¶ Plugin 2&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Plugin2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çœ‹åˆ°è¿™é‡Œæˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†åŒå­¦éƒ½å·²ç»ååº”è¿‡æ¥äº†ï¼Œ<code>compiler.hooks.run.tap</code>å’Œ<code>compiler.hooks.done.tap</code>ä¸å°±æ˜¯ä¸Šè¾¹è®²åˆ°çš„é€šè¿‡<code>tapable</code>åˆ›å»ºä¸€ä¸ª<code>SyncHook</code>å®ä¾‹ç„¶åé€šè¿‡<code>tap</code>æ–¹æ³•æ³¨å†Œäº‹ä»¶å—ï¼Ÿ</p><p>æ²¡é”™ï¼çš„ç¡®æ˜¯è¿™æ ·ï¼Œå…³äº<code>webpack</code>æ’ä»¶<strong>æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡å‘å¸ƒè®¢é˜…çš„æ¨¡å¼ï¼Œé€šè¿‡<code>compiler</code>ä¸Šç›‘å¬äº‹ä»¶ã€‚ç„¶åå†æ‰“åŒ…ç¼–è¯‘è¿‡ç¨‹ä¸­è§¦å‘ç›‘å¬çš„äº‹ä»¶ä»è€Œæ·»åŠ ä¸€å®šçš„é€»è¾‘å½±å“æ‰“åŒ…ç»“æœ</strong>ã€‚</p><p>æˆ‘ä»¬åœ¨æ¯ä¸ªæ’ä»¶çš„<code>apply</code>æ–¹æ³•ä¸Šé€šè¿‡<code>tap</code>åœ¨ç¼–è¯‘å‡†å¤‡é˜¶æ®µ(ä¹Ÿå°±æ˜¯è°ƒç”¨<code>webpack()</code>å‡½æ•°æ—¶)è¿›è¡Œè®¢é˜…å¯¹åº”çš„äº‹ä»¶ï¼Œå½“æˆ‘ä»¬çš„ç¼–è¯‘æ‰§è¡Œåˆ°ä¸€å®šé˜¶æ®µæ—¶å‘å¸ƒå¯¹åº”çš„äº‹ä»¶å‘Šè¯‰è®¢é˜…è€…å»æ‰§è¡Œç›‘å¬çš„äº‹ä»¶ï¼Œä»è€Œè¾¾åˆ°åœ¨ç¼–è¯‘é˜¶æ®µçš„ä¸åŒç”Ÿå‘½å‘¨æœŸå†…å»è§¦å‘å¯¹åº”çš„<code>plugin</code>ã€‚</p><blockquote><p>æ‰€ä»¥è¿™é‡Œåº”è¯¥æ¸…æ¥šï¼Œåœ¨è¿›è¡Œ<code>webpack</code>æ’ä»¶å¼€å‘æ—¶ï¼Œ<code>compiler</code>å¯¹è±¡ä¸Šå­˜æ”¾ç€æœ¬æ¬¡æ‰“åŒ…çš„æ‰€æœ‰ç›¸å…³å±æ€§ï¼Œæ¯”å¦‚<code>options</code>æ‰“åŒ…çš„é…ç½®ï¼Œä»¥åŠä¹‹åè®²åˆ°çš„å„ç§å±æ€§ã€‚</p></blockquote><h3 id="å¯»æ‰¾entryå…¥å£" tabindex="-1"><a class="header-anchor" href="#å¯»æ‰¾entryå…¥å£"><span>å¯»æ‰¾<code>entry</code>å…¥å£</span></a></h3><p>è¿™ä¹‹åï¼Œç»å¤§å¤šæ•°å†…å®¹éƒ½ä¼šæ”¾åœ¨<code>compiler.js</code>ä¸­å»å®ç°<code>Compiler</code>è¿™ä¸ªç±»å®ç°æ‰“åŒ…çš„æ ¸å¿ƒæµç¨‹ã€‚</p><p><strong>ä»»ä½•ä¸€æ¬¡æ‰“åŒ…éƒ½éœ€è¦å…¥å£æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬å°±ä»çœŸæ­£è¿›å…¥æ‰“åŒ…ç¼–è¯‘é˜¶æ®µã€‚é¦–å½“å…¶å†²çš„äº‹æƒ…å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å…¥å£é…ç½®æ–‡ä»¶è·¯å¾„å¯»æ‰¾åˆ°å¯¹åº”å…¥å£æ–‡ä»¶ã€‚</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler ç±»è¿›è¡Œæ ¸å¿ƒç¼–è¯‘å®ç°
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> toUnixPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options

    <span class="token comment">// ç›¸å¯¹è·¯å¾„æ ¹è·¯å¾„ Context å‚æ•°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rootPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>context <span class="token operator">||</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// åˆ›å»ºpluginçš„hooks</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¼€å§‹ç¼–è¯‘çš„hook</span>
      <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// è¾“å‡º asset åˆ° output ç›®å½•ä¹‹å‰çš„hookï¼Œ å³å†™å…¥æ–‡ä»¶ä¹‹å‰</span>
      <span class="token literal-property property">emit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// åœ¨ compilation å®Œæˆæ—¶æ‰§è¡Œ å…¨éƒ¨å®Œæˆç¼–è¯‘æ‰§è¡Œ</span>
      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// runæ–¹æ³•å¯åŠ¨ç¼–è¯‘, åŒæ—¶runæ–¹æ³•æ¥å—å¤–éƒ¨ä¼ é€’çš„callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å½“è°ƒç”¨runæ–¹æ³•æ—¶ï¼Œè§¦å‘å¼€å§‹ç¼–è¯‘çš„plugin</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// è·å–å…¥å£é…ç½®å¯¹è±¡</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> entry <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">entry</span><span class="token operator">:</span> optionEntry <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> optionEntry <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entry<span class="token punctuation">[</span><span class="token string">&#39;main&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> optionEntry
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      entry <span class="token operator">=</span> optionEntry
    <span class="token punctuation">}</span>

    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryKey</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> entryValue <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryKey<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>entryValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„çš„åŒæ—¶åŒæ„è·¯å¾„åˆ†éš”ç¬¦è¯¶ /</span>
        entry<span class="token punctuation">[</span>entryKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> entryValue<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> entry
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * ç»Ÿä¸€è·¯å¾„åˆ†éš”ç¬¦ ä¸»è¦æ˜¯ä¸ºäº†åç»­ç”Ÿæˆæ¨¡å—IDæ–¹ä¾¿
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">path</span>
 * <span class="token keyword">@returns</span>
 */</span>
<span class="token keyword">function</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\\\</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ­¥æˆ‘ä»¬é€šè¿‡<code>options.entry</code>å¤„ç†è·å¾—å…¥å£æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚</p><p>è¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„å°ç‚¹:</p><ul><li><code>this.hooks.run.call()</code></li></ul><p>åœ¨æˆ‘ä»¬<code>_loadePlugins</code>å‡½æ•°ä¸­å¯¹äºæ¯ä¸€ä¸ªä¼ å…¥çš„æ’ä»¶åœ¨<code>compiler</code>å®ä¾‹å¯¹è±¡ä¸­è¿›è¡Œäº†è®¢é˜…ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨<code>run</code>æ–¹æ³•æ—¶ï¼Œç­‰äºçœŸæ­£å¼€å§‹æ‰§è¡Œç¼–è¯‘ã€‚è¿™ä¸ªé˜¶æ®µ<strong>ç›¸å½“äºæˆ‘ä»¬éœ€è¦å‘Šè¯‰è®¢é˜…è€…ï¼Œå‘å¸ƒå¼€å§‹æ‰§è¡Œçš„è®¢é˜…</strong>ã€‚æ­¤æ—¶æˆ‘ä»¬é€šè¿‡<code>this.hooks.run.call()</code>æ‰§è¡Œå…³äº<code>run</code>çš„æ‰€æœ‰<code>tap</code>ç›‘å¬æ–¹æ³•ï¼Œä»è€Œè§¦å‘å¯¹åº”çš„<code>plugin</code>é€»è¾‘ã€‚</p><ul><li><code>this.rootPath</code>:</li></ul><p>åœ¨ä¸Šè¿°çš„å¤–éƒ¨<code>webpack.config.js</code>ä¸­æˆ‘ä»¬é…ç½®äº†ä¸€ä¸ª <code>context: process.cwd()</code>ï¼Œå…¶å®çœŸå®<code>webpack</code>ä¸­è¿™ä¸ª<code>context</code>å€¼é»˜è®¤ä¹Ÿæ˜¯<code>process.cwd()</code>ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªè·¯å¾„å°±æ˜¯æˆ‘ä»¬é¡¹ç›®å¯åŠ¨çš„ç›®å½•è·¯å¾„ï¼Œä»»ä½•<code>entry</code>å’Œ<code>loader</code>ä¸­çš„ç›¸å¯¹è·¯å¾„éƒ½æ˜¯é’ˆå¯¹äº<code>context</code>è¿™ä¸ªå‚æ•°çš„ç›¸å¯¹è·¯å¾„ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>this.rootPath</code>åœ¨æ„é€ å‡½æ•°ä¸­æ¥ä¿å­˜è¿™ä¸ªå˜é‡ã€‚</p><ul><li><code>toUnixPath</code>å·¥å…·æ–¹æ³•:</li></ul><p>å› ä¸ºä¸åŒæ“ä½œç³»ç»Ÿä¸‹ï¼Œæ–‡ä»¶åˆ†éš”è·¯å¾„æ˜¯ä¸åŒçš„ã€‚è¿™é‡Œæˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨<code>\\</code>æ¥æ›¿æ¢è·¯å¾„ä¸­çš„<code>//</code>æ¥æ›¿æ¢æ¨¡å—è·¯å¾„ã€‚åç»­æˆ‘ä»¬ä¼š<strong>ä½¿ç”¨æ¨¡å—ç›¸å¯¹äº<code>rootPath</code>çš„è·¯å¾„ä½œä¸ºæ¯ä¸€ä¸ªæ–‡ä»¶çš„å”¯ä¸€ID</strong>ï¼Œæ‰€ä»¥è¿™é‡Œç»Ÿä¸€å¤„ç†ä¸‹è·¯å¾„åˆ†éš”ç¬¦ã€‚</p><ul><li><code>entry</code>çš„å¤„ç†æ–¹æ³•:</li></ul><p>å…³äº<code>entry</code>é…ç½®ï¼Œ<code>webpack</code>ä¸­å…¶å®æœ‰å¾ˆå¤šç§ã€‚æˆ‘ä»¬è¿™é‡Œè€ƒè™‘äº†æ¯”è¾ƒå¸¸è§çš„ä¸¤ç§é…ç½®æ–¹å¼:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">&#39;entry1.js&#39;</span>

<span class="token comment">// æœ¬è´¨ä¸Šè¿™æ®µä»£ç åœ¨webpackä¸­ä¼šè¢«è½¬åŒ–ä¸º</span>
<span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">main</span><span class="token operator">:</span>&#39;entry1<span class="token punctuation">.</span>js
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&#39;entry1&#39;</span><span class="token operator">:</span><span class="token string">&#39;./entry1.js&#39;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&#39;entry2&#39;</span><span class="token operator">:</span><span class="token string">&#39;/user/wepback/example/src/entry2.js&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸¤ç§æ–¹å¼ä»»ä½•æ–¹å¼éƒ½ä¼šç»è¿‡<code>getEntry</code>æ–¹æ³•æœ€ç»ˆè½¬åŒ–ç§°ä¸º<code>{ [æ¨¡å—å]:[æ¨¡å—ç»å¯¹è·¯å¾„]... }</code>çš„å½¢å¼ï¼Œå…³äº<code>getEntry()</code>æ–¹æ³•å…¶å®éå¸¸ç®€å•ï¼Œè¿™é‡Œå°±ä¸è¿‡äºç´¯èµ˜è¿™ä¸ªæ–¹æ³•çš„å®ç°è¿‡ç¨‹äº†ã€‚</p><p>è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±é€šè¿‡<code>getEntry</code>æ–¹æ³•è·å¾—äº†ä¸€ä¸ª<code>key</code>ä¸º<code>entryName</code>,<code>value</code>ä¸º<code>entryAbsolutePath</code>çš„å¯¹è±¡äº†ï¼Œæ¥æ¥ä¸‹å°±è®©æˆ‘ä»¬ä»å…¥å£æ–‡ä»¶å‡ºå‘è¿›è¡Œç¼–è¯‘æµç¨‹å§ã€‚</p><h2 id="æ¨¡å—ç¼–è¯‘é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—ç¼–è¯‘é˜¶æ®µ"><span>æ¨¡å—ç¼–è¯‘é˜¶æ®µ</span></a></h2><p>ä¸Šè¾¹æˆ‘ä»¬è®²è¿°äº†å…³äºç¼–è¯‘é˜¶æ®µçš„å‡†å¤‡å·¥ä½œ:</p><ul><li>ç›®å½•/æ–‡ä»¶åŸºç¡€é€»è¾‘è¡¥å……ã€‚</li><li>é€šè¿‡<code>hooks.tap</code>æ³¨å†Œ<code>webpack</code>æ’ä»¶ã€‚</li><li><code>getEntry</code>æ–¹æ³•è·å¾—å„ä¸ªå…¥å£çš„å¯¹è±¡ã€‚</li></ul><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬ç»§ç»­å®Œå–„<code>compiler.js</code>ã€‚</p><p>åœ¨æ¨¡å—ç¼–è¯‘é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹ä»¶:</p><ul><li>æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„ï¼Œåˆ†æå…¥å£æ–‡ä»¶ï¼Œå¯¹äºå…¥å£æ–‡ä»¶è¿›è¡ŒåŒ¹é…å¯¹åº”çš„<code>loader</code>è¿›è¡Œå¤„ç†å…¥å£æ–‡ä»¶ã€‚</li><li>å°†<code>loader</code>å¤„ç†å®Œæˆçš„å…¥å£æ–‡ä»¶ä½¿ç”¨<code>webpack</code>è¿›è¡Œç¼–è¯‘ã€‚</li><li>åˆ†æå…¥å£æ–‡ä»¶ä¾èµ–ï¼Œé‡å¤ä¸Šè¾¹ä¸¤ä¸ªæ­¥éª¤ç¼–è¯‘å¯¹åº”ä¾èµ–ã€‚</li><li>å¦‚æœåµŒå¥—æ–‡ä»¶å­˜åœ¨ä¾èµ–æ–‡ä»¶ï¼Œé€’å½’è°ƒç”¨ä¾èµ–æ¨¡å—è¿›è¡Œç¼–è¯‘ã€‚</li><li>é€’å½’ç¼–è¯‘å®Œæˆåï¼Œç»„è£…ä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„<code>chunk</code></li></ul><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥ç»™<code>compiler.js</code>çš„æ„é€ å‡½æ•°ä¸­è¡¥å……ä¸€ä¸‹å¯¹åº”çš„é€»è¾‘:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
    <span class="token keyword">this</span><span class="token punctuation">.</span>entries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä¿å­˜æ‰€æœ‰å…¥å£æ¨¡å—å¯¹è±¡</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä¿å­˜æ‰€æœ‰ä¾èµ–æ¨¡å—å¯¹è±¡</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ‰€æœ‰çš„ä»£ç å—å¯¹è±¡</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>assets <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å­˜æ”¾æœ¬æ¬¡äº§å‡ºçš„æ–‡ä»¶å¯¹è±¡</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å­˜æ”¾æœ¬æ¬¡ç¼–è¯‘æ‰€æœ‰äº§å‡ºçš„æ–‡ä»¶å</span>

    <span class="token comment">// åˆ›å»ºpluginçš„hooks</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¼€å§‹ç¼–è¯‘çš„hook</span>
      <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// è¾“å‡º asset åˆ° output ç›®å½•ä¹‹å‰çš„hookï¼Œ å³å†™å…¥æ–‡ä»¶ä¹‹å‰</span>
      <span class="token literal-property property">emit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// åœ¨ compilation å®Œæˆæ—¶æ‰§è¡Œ å…¨éƒ¨å®Œæˆç¼–è¯‘æ‰§è¡Œ</span>
      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ç»™<code>compiler</code>æ„é€ å‡½æ•°ä¸­æ·»åŠ ä¸€äº›åˆ—å±æ€§æ¥ä¿å­˜å…³äºç¼–è¯‘é˜¶æ®µç”Ÿæˆçš„å¯¹åº”èµ„æº/æ¨¡å—å¯¹è±¡ã€‚</p><blockquote><p>å…³äº<code>entries\\modules\\chunks\\assets\\files</code>è¿™å‡ ä¸ª<code>Set</code>å¯¹è±¡æ˜¯è´¯ç©¿æˆ‘ä»¬æ ¸å¿ƒæ‰“åŒ…æµç¨‹çš„å±æ€§ï¼Œå®ƒä»¬å„è‡ªç”¨æ¥å‚¨å­˜ç¼–è¯‘é˜¶æ®µä¸åŒçš„èµ„æºï¼Œä»è€Œæœ€ç»ˆé€šè¿‡å¯¹åº”çš„å±æ€§è¿›è¡Œç”Ÿæˆç¼–è¯‘åçš„æ–‡ä»¶ã€‚</p></blockquote><h3 id="æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„åˆ†æå…¥å£æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„åˆ†æå…¥å£æ–‡ä»¶"><span>æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„åˆ†æå…¥å£æ–‡ä»¶</span></a></h3><p>ä¸Šè¾¹è¯´åˆ°æˆ‘ä»¬åœ¨<code>run</code>æ–¹æ³•ä¸­å·²ç»å¯ä»¥é€šè¿‡<code>this.getEntry();</code>è·å¾—å¯¹åº”çš„å…¥å£å¯¹è±¡äº†ï½</p><p>æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ä»å…¥å£æ–‡ä»¶å¼€å§‹å»åˆ†æå…¥å£æ–‡ä»¶å§ï¼</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler ç±»è¿›è¡Œæ ¸å¿ƒç¼–è¯‘å®ç°
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>SyncHook<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>toUnixPath<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// runæ–¹æ³•å¯åŠ¨ç¼–è¯‘, åŒæ—¶runæ–¹æ³•æ¥å—å¤–éƒ¨ä¼ é€’çš„callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å½“è°ƒç”¨runæ–¹æ³•æ—¶ï¼Œè§¦å‘å¼€å§‹ç¼–è¯‘çš„plugin</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// è·å–å…¥å£é…ç½®å¯¹è±¡</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ç¼–è¯‘å…¥å£æ–‡ä»¶</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildEntryModule</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
  
  <span class="token function">buildEntryModule</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> entryPath <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryName<span class="token punctuation">]</span>
      <span class="token keyword">const</span> entityObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entryPath<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸º<code>buildEntryModule</code>æ–¹æ³•ä½œä¸ºå…¥å£æ¨¡å—ç¼–è¯‘æ–¹æ³•ã€‚å¾ªç¯å…¥å£å¯¹è±¡ï¼Œå¾—åˆ°æ¯ä¸€ä¸ªå…¥å£å¯¹è±¡çš„åç§°å’Œè·¯å¾„ã€‚</p><blockquote><p>å‡ä½¿æˆ‘ä»¬åœ¨å¼€å¤´ä¼ å…¥<code>entry:{ main:&#39;./src/main.js&#39; }</code>çš„è¯ï¼Œ<code>buildEntryModule</code>è·å¾—çš„å½¢å‚<code>entry</code>ä¸º<code>{ main: &quot;/src...[ä½ çš„ç»å¯¹è·¯å¾„]&quot; }</code>ï¼Œæ­¤æ—¶æˆ‘ä»¬<code>buildModule</code>æ–¹æ³•æ¥å—çš„<code>entryName</code>ä¸º<code>main</code>ï¼Œ<code>entryPath</code>ä¸ºå…¥å£æ–‡ä»¶<code>main</code>å¯¹åº”çš„çš„ç»å¯¹è·¯å¾„ã€‚å•ä¸ªå…¥å£ç¼–è¯‘å®Œæˆåï¼Œæˆ‘ä»¬ä¼šåœ¨<code>buildModule</code>æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å°±æ˜¯æˆ‘ä»¬ç¼–è¯‘å…¥å£æ–‡ä»¶åçš„å¯¹è±¡ã€‚</p></blockquote><h3 id="buildmoduleæ¨¡å—ç¼–è¯‘æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#buildmoduleæ¨¡å—ç¼–è¯‘æ–¹æ³•"><span>buildModuleæ¨¡å—ç¼–è¯‘æ–¹æ³•</span></a></h3><p>åœ¨è¿›è¡Œä»£ç ç¼–å†™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸€ä¸‹<code>buildModule</code>æ–¹æ³•å®ƒéœ€è¦åšå“ªäº›äº‹æƒ…:</p><ul><li><code>buildModule</code>æ¥å—ä¸¤ä¸ªå‚æ•°è¿›è¡Œæ¨¡å—ç¼–è¯‘ï¼Œ<strong>ç¬¬ä¸€ä¸ªä¸ºæ¨¡å—æ‰€å±çš„å…¥å£æ–‡ä»¶åç§°</strong>ï¼Œç¬¬äºŒä¸ªä¸ºéœ€è¦ç¼–è¯‘çš„æ¨¡å—è·¯å¾„ã€‚</li><li><code>buildModule</code>æ–¹æ³•è¦è¿›è¡Œä»£ç ç¼–è¯‘çš„å‰æå°±æ˜¯ï¼Œé€šè¿‡<code>fs</code>æ¨¡å—æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶æºä»£ç ã€‚</li><li>è¯»å–æ–‡ä»¶å†…å®¹ä¹‹åï¼Œè°ƒç”¨æ‰€æœ‰åŒ¹é…çš„loaderå¯¹æ¨¡å—è¿›è¡Œå¤„ç†å¾—åˆ°è¿”å›åçš„ç»“æœã€‚</li><li>å¾—åˆ°<code>loader</code>å¤„ç†åçš„ç»“æœï¼Œé€šè¿‡<code>babel</code>åˆ†æ<code>loader</code>å¤„ç†åçš„ä»£ç ï¼Œè¿›è¡Œä»£ç ç¼–è¯‘ã€‚(è¿™ä¸€æ­¥ç¼–è¯‘ä¸»è¦æ˜¯é’ˆå¯¹<code>require</code>è¯­å¥ï¼Œä¿®æ”¹æºä»£ç ä¸­<code>require</code>è¯­å¥çš„è·¯å¾„)ã€‚</li><li>å¦‚æœè¯¥å…¥å£æ–‡ä»¶æ²¡æœ‰ä¾èµ–ä¸ä»»ä½•æ¨¡å—(<code>require</code>è¯­å¥)ï¼Œé‚£ä¹ˆè¿”å›ç¼–è¯‘åçš„æ¨¡å—å¯¹è±¡ã€‚</li><li>å¦‚æœè¯¥å…¥å£æ–‡ä»¶å­˜åœ¨ä¾èµ–çš„æ¨¡å—ï¼Œé€’å½’<code>buildModule</code>æ–¹æ³•è¿›è¡Œæ¨¡å—ç¼–è¯‘ã€‚</li></ul><h4 id="è¯»å–æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#è¯»å–æ–‡ä»¶å†…å®¹"><span>è¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><p>æˆ‘ä»¬å…ˆè°ƒç”¨<code>fs</code>æ¨¡å—è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
<span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.è¯»å–æ–‡ä»¶åŸå§‹ä»£ç </span>
  <span class="token keyword">const</span> originalSourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// moduleCode ä¸ºä¿®æ”¹åä»£ç </span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> originalSourceCode
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è°ƒç”¨loaderå¤„ç†åŒ¹é…åç¼€æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#è°ƒç”¨loaderå¤„ç†åŒ¹é…åç¼€æ–‡ä»¶"><span>è°ƒç”¨<code>loader</code>å¤„ç†åŒ¹é…åç¼€æ–‡ä»¶</span></a></h4><p>â€‹ æ¥ä¸‹æ¥æˆ‘ä»¬è·å¾—äº†æ–‡ä»¶çš„å…·ä½“å†…å®¹ä¹‹åï¼Œå°±éœ€è¦åŒ¹é…å¯¹åº”<code>loader</code>å¯¹æˆ‘ä»¬çš„æºä»£ç è¿›è¡Œç¼–è¯‘äº†ã€‚</p><h5 id="å®ç°ç®€å•è‡ªå®šä¹‰loader" tabindex="-1"><a class="header-anchor" href="#å®ç°ç®€å•è‡ªå®šä¹‰loader"><span>å®ç°ç®€å•è‡ªå®šä¹‰loader</span></a></h5><p>åœ¨è¿›è¡Œ<code>loader</code>ç¼–è¯‘å‰ï¼Œå…ˆæ¥å®ç°ä¸€ä¸‹ä¸Šæ–¹ä¼ å…¥çš„è‡ªå®šä¹‰<code>loader</code>å§ã€‚<code>webpack-demo/loader</code>ç›®å½•ä¸‹æ–°å»º<code>loader1.js</code>,<code>loader2.js</code>:</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ¸…æ¥š<strong>ç®€å•æ¥è¯´<code>loader</code>æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—æˆ‘ä»¬çš„æºä»£ç ä½œä¸ºå…¥å‚åŒæ—¶è¿”å›å¤„ç†åçš„ç»“æœã€‚</strong></p><blockquote><p>å› ä¸ºæ–‡ç« ä¸»è¦è®²è¿°æ‰“åŒ…æµç¨‹æ‰€ä»¥<code>loader</code>ç®€å•çš„ä½œä¸ºå€’åºå¤„ç†ã€‚</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// loaderæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—åŸå§‹å†…å®¹ï¼Œè¿”å›è½¬æ¢åçš„å†…å®¹</span>
<span class="token keyword">function</span> <span class="token function">loader1</span><span class="token punctuation">(</span><span class="token parameter">sourceCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;use loader1&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sourceCode <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\\n const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// loaderæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—åŸå§‹å†…å®¹ï¼Œè¿”å›è½¬æ¢åçš„å†…å®¹</span>
<span class="token keyword">function</span> <span class="token function">loader2</span><span class="token punctuation">(</span><span class="token parameter">sourceCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;use loader2&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sourceCode <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\\n const loader2 = &quot;I&#39;m loader2&quot;;</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ä½¿ç”¨loaderå¤„ç†æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨loaderå¤„ç†æ–‡ä»¶"><span>ä½¿ç”¨loaderå¤„ç†æ–‡ä»¶</span></a></h5><p>ææ¸…æ¥šäº†<code>loader</code>å°±æ˜¯ä¸€ä¸ªå•çº¯çš„å‡½æ•°ä¹‹åï¼Œè®©æˆ‘ä»¬åœ¨è¿›è¡Œæ¨¡å—åˆ†æä¹‹å‰å°†å†…å®¹å…ˆäº¤ç»™åŒ¹é…çš„loaderå»å¤„ç†ä¸‹å§ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.è¯»å–æ–‡ä»¶åŸå§‹ä»£ç </span>
  <span class="token keyword">const</span> originalSourceCode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>originalSourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// moduleCode ä¸ºä¿®æ”¹åä»£ç </span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> originalSourceCode
  <span class="token comment">// 2.è°ƒç”¨ loader è¿›è¡Œå¤„ç†</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleLoader</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">handleLoader</span><span class="token punctuation">(</span><span class="token parameter">modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 1.è·å–æ‰€æœ‰ä¼ å…¥çš„loaderè§„åˆ™</span>
  <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules
  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">loader</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> testRule <span class="token operator">=</span> loader<span class="token punctuation">.</span>test
    <span class="token keyword">if</span> <span class="token punctuation">(</span>testRule<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä»…è€ƒè™‘loader { test:/\\.js$/g, use:[&#39;babel-loader&#39;] } }</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>loader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        matchLoaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        matchLoaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>loader<span class="token punctuation">.</span>use<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2.å€’åºæ‰§è¡Œloaderä¼ å…¥çš„æºä»£ç </span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> matchLoaders<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç›®å‰æˆ‘ä»¬å¤–éƒ¨ä»…æ”¯æŒä¼ å…¥ç»å¯¹è·¯å¾„çš„loaderæ¨¡å¼</span>
      <span class="token comment">// require å¼•å…¥å¯¹åº”çš„loader</span>
      <span class="token keyword">const</span> loaderFn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>matchLoaders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// é€šè¿‡ loader åŒæ­¥å¤„ç†æ¯ä¸€æ¬¡ç¼–è¯‘çš„moduleCode</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> <span class="token function">loaderFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œé€šè¿‡<code>handleLoader</code>å‡½æ•°ï¼Œå¯¹äºä¼ å…¥çš„æ–‡ä»¶è·¯å¾„åŒ¹é…åˆ°å¯¹åº”åç¼€çš„<code>loader</code>åï¼Œä¾æ¬¡å€’åºæ‰§è¡Œloaderå¤„ç†ä»£ç <code>this.moduleCode</code>å¹¶ä¸”åŒæ­¥æ›´æ–°æ¯æ¬¡<code>moduleCode</code>ã€‚</p><p>æœ€ç»ˆï¼Œåœ¨æ¯ä¸€ä¸ªæ¨¡å—ç¼–è¯‘ä¸­<code>this.moduleCode</code>éƒ½ä¼šç»è¿‡å¯¹åº”çš„<code>loader</code>å¤„ç†ã€‚</p><h4 id="webpackæ¨¡å—ç¼–è¯‘é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#webpackæ¨¡å—ç¼–è¯‘é˜¶æ®µ"><span>webpackæ¨¡å—ç¼–è¯‘é˜¶æ®µ</span></a></h4><p>ä¸Šä¸€æ­¥ç»å†è¿‡<code>loader</code>å¤„ç†äº†å…¥å£æ–‡ä»¶ä»£ç ï¼Œå¹¶ä¸”å¾—åˆ°äº†å¤„ç†åçš„ä»£ç ä¿å­˜åœ¨äº†<code>this.moduleCode</code>ä¸­ã€‚</p><p>æ­¤æ—¶ï¼Œç»è¿‡<code>loader</code>å¤„ç†åå°±è¦è¿›å…¥<code>webpack</code>å†…éƒ¨çš„ç¼–è¯‘é˜¶æ®µäº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼š<strong>é’ˆå¯¹å½“å‰æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼Œå°†å½“å‰æ¨¡å—æ‰€æœ‰ä¾èµ–çš„æ¨¡å—(<code>require()</code>)è¯­å¥å¼•å…¥çš„è·¯å¾„å˜ä¸ºç›¸å¯¹äºè·Ÿè·¯å¾„(<code>this.rootPath</code>)çš„ç›¸å¯¹è·¯å¾„</strong>ã€‚</p><blockquote><p>æ€»ä¹‹éœ€è¦ææ˜ç™½çš„æ˜¯ï¼Œè¿™é‡Œç¼–è¯‘çš„ç»“æœæ˜¯æœŸæœ›å°†æºä»£ç ä¸­çš„ä¾èµ–æ¨¡å—è·¯å¾„å˜ä¸ºç›¸å¯¹è·Ÿè·¯å¾„çš„è·¯å¾„ï¼ŒåŒæ—¶å»ºç«‹åŸºç¡€çš„æ¨¡å—ä¾èµ–å…³ç³»ã€‚åç»­ä¼šè¯´æ˜ä¸ºä»€ä¹ˆé’ˆå¯¹è·¯å¾„è¿›è¡Œç¼–è¯‘ã€‚</p></blockquote><p>ç»§ç»­æ¥å®Œå–„<code>buildModule</code>æ–¹æ³•:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>toUnixPath<span class="token punctuation">,</span> tryExtensions<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils/index&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/parser&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/traverse&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/generator&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/types&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.è¯»å–æ–‡ä»¶åŸå§‹ä»£ç </span>
    <span class="token comment">// const originalSourceCode = (this.originalSourceCode = fs.readFileSync(modulePath, &#39;utf-8&#39;))</span>
    <span class="token keyword">const</span> originalSourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
    <span class="token comment">// moduleCode ä¸ºä¿®æ”¹åä»£ç </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> originalSourceCode
    <span class="token comment">// 2.è°ƒç”¨ loader è¿›è¡Œå¤„ç†</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleLoader</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
    <span class="token comment">// 3.è°ƒç”¨ webpack è¿›è¡Œæ¨¡å—ç¼–è¯‘ è·å¾—æœ€ç»ˆçš„ module å¯¹è±¡</span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWebpackCompiler</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span>
    <span class="token keyword">return</span> module
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
    
  <span class="token comment">// ä½¿ç”¨ webpack è¿›è¡Œæ¨¡å—ç¼–è¯‘</span>
  <span class="token function">handleWebpackCompiler</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°†å½“å‰æ¨¡å—ç›¸å¯¹äºå¯åŠ¨æ ¹ç›®å½•è®¡ç®—å‡ºç›¸å¯¹è·¯å¾„ ä½œä¸ºæ¨¡å—ID</span>
    <span class="token keyword">const</span> moduleId <span class="token operator">=</span> <span class="token string">&#39;./&#39;</span> <span class="token operator">+</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆ›å»ºæ¨¡å—å¯¹è±¡</span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// è¯¥æ¨¡å—æ‰€ä¾èµ–æ¨¡å—ç»å¯¹è·¯å¾„åœ°å€</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// è¯¥æ¨¡å¿«æ‰€å±çš„å…¥å£æ–‡ä»¶</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è°ƒç”¨ babel åˆ†æä»£ç </span>
    <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&#39;module&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// æ·±åº¦ä¼˜åŒ– éå†è¯­æ³•tree</span>
    <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">CallExpression</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">nodePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> nodePath<span class="token punctuation">.</span>node
        <span class="token comment">// å½“é‡åˆ° require è¯­å¥æ—¶</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;require&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// è·å¾—æºä»£ç ä¸­å¼•å…¥æ¨¡å—ç›¸å¯¹è·¯å¾„</span>
          <span class="token keyword">const</span> moduleName <span class="token operator">=</span> node<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
          <span class="token comment">// å¯»æ‰¾æ¨¡å—ç›¸å¯¹è·¯å¾„ å½“å‰æ¨¡å—è·¯å¾„ + require() å¯¹åº”çš„ç›¸å¯¹è·¯å¾„</span>
          <span class="token keyword">const</span> moduleDirName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
          <span class="token keyword">const</span> absolutePath <span class="token operator">=</span> <span class="token function">tryExtensions</span><span class="token punctuation">(</span>
            <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>moduleDirName<span class="token punctuation">,</span> moduleName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions<span class="token punctuation">,</span>
            moduleName<span class="token punctuation">,</span>
            <span class="token function">toUnixPath</span><span class="token punctuation">(</span>moduleDirName<span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
          <span class="token comment">// ç”Ÿæˆ moduleId - é’ˆå¯¹äºæ ¹è·¯å¾„çš„æ¨¡å—ID æ·»åŠ è¿›å…¥æ–°çš„ä¾èµ–æ¨¡å—è·¯å¾„</span>
          <span class="token keyword">const</span> moduleId <span class="token operator">=</span> <span class="token string">&#39;./&#39;</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> absolutePath<span class="token punctuation">)</span>
          <span class="token comment">// é€šè¿‡ babel ä¿®æ”¹æºä»£ç ä¸­çš„ require å˜æˆ __webpack_require__ è¯­å¥</span>
          node<span class="token punctuation">.</span>callee <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;__webpack_require__&#39;</span><span class="token punctuation">)</span>
          <span class="token comment">// ä¿®æ”¹æºä»£ç ä¸­ require è¯­å¥å¼•å…¥çš„æ¨¡å— å…¨éƒ¨ä¿®æ”¹é—®ç›¸å¯¹äºæ ¹è·¯å¾„æ¥å¤„ç†</span>
          node<span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">]</span>
          <span class="token comment">// ä¸ºå½“å‰æ¨¡å—æ·»åŠ  require è¯­å¥é€ æˆçš„ä¾èµ–(å†…å®¹ä¸ºç›¸å¯¹äºæ ¹è·¯å¾„çš„æ¨¡å—ID)</span>
          module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// éå†ç»“æŸæ ¹æ® AST ç”Ÿæˆæ–°çš„ä»£ç </span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
    <span class="token comment">// ä¸ºå½“å‰æ¨¡å—æŒ‚è½½æ–°çš„ç”Ÿæˆçš„ä»£ç </span>
    module<span class="token punctuation">.</span>_source <span class="token operator">=</span> code
    <span class="token comment">// è¿”å›å½“å‰æ¨¡å—å¯¹è±¡</span>
    <span class="token keyword">return</span> module
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ­¥å…³äº<code>webpack</code>ç¼–è¯‘çš„é˜¶æ®µå°±å®Œæˆäº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯:</p><ul><li><p>è¿™é‡Œä½¿ç”¨<code>babel</code>ç›¸å…³çš„<code>API</code>é’ˆå¯¹äº<code>require</code>è¯­å¥è¿›è¡Œäº†ç¼–è¯‘ã€‚</p></li><li><p>åŒæ—¶ä»£ç ä¸­å¼•ç”¨äº†ä¸€ä¸ª<code>tryExtensions()</code>å·¥å…·æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯é’ˆå¯¹äºåç¼€åä¸å…¨çš„å·¥å…·æ–¹æ³•ï¼Œç¨åä½ å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„å…·ä½“å†…å®¹ã€‚</p></li><li><p>é’ˆå¯¹äºæ¯ä¸€æ¬¡æ–‡ä»¶ç¼–è¯‘ï¼Œæˆ‘ä»¬éƒ½ä¼šè¿”å›ä¸€ä¸ª<strong>module</strong>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯é‡ä¸­ä¹‹é‡ã€‚</p></li><li><ul><li><code>id</code>å±æ€§ï¼Œè¡¨ç¤ºå½“å‰æ¨¡å—é’ˆå¯¹äº<code>this.rootPath</code>çš„ç›¸å¯¹ç›®å½•ã€‚</li><li><code>dependencies</code>å±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>Set</code>å†…éƒ¨ä¿å­˜äº†è¯¥æ¨¡å—ä¾èµ–çš„æ‰€æœ‰æ¨¡å—çš„æ¨¡å—IDã€‚</li><li><code>name</code>å±æ€§,å®ƒè¡¨ç¤ºè¯¥æ¨¡å—å±äºå“ªä¸ªå…¥å£æ–‡ä»¶ã€‚</li><li><code>_source</code>å±æ€§ï¼Œå®ƒå­˜æ”¾æ¨¡å—è‡ªèº«ç»è¿‡<code>babel</code>ç¼–è¯‘åçš„å­—ç¬¦ä¸²ä»£ç ã€‚</li></ul></li></ul><h5 id="tryextensionsæ–¹æ³•å®ç°" tabindex="-1"><a class="header-anchor" href="#tryextensionsæ–¹æ³•å®ç°"><span>tryExtensionsæ–¹æ³•å®ç°</span></a></h5><p>åœ¨ä¸Šæ–‡çš„<code>webpack.config.js</code>æœ‰è¿™ä¹ˆä¸€ä¸ªé…ç½®ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.vue&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç†Ÿæ‚‰<code>webpack</code>é…ç½®å¯èƒ½æ¸…æ¥šï¼Œ<strong>resolve.extensions</strong>æ˜¯é’ˆå¯¹äºå¼•å…¥ä¾èµ–æ—¶ï¼Œåœ¨æ²¡æœ‰ä¹¦å†™æ–‡ä»¶åç¼€çš„æƒ…å†µä¸‹ï¼Œ<code>webpack</code>ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æŒ‰ç…§ä¼ å…¥çš„è§„åˆ™ä¸ºæ–‡ä»¶æ·»åŠ åç¼€ã€‚</p><p>åœ¨æ¸…æ¥šäº†åŸç†åæˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹<code>utils/tryExtensions</code>æ–¹æ³•çš„å®ç°:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">modulePath</span> path.posix.joinæ‹¿åˆ°çš„æ¨¡å—ç»å¯¹è·¯å¾„
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">extensions</span> æ‰©å±•åæ•°ç»„
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">originModulePath</span> åŸå§‹å¼•å…¥æ¨¡å—è·¯å¾„
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">moduleContext</span> path.posix.dirnameæ‹¿åˆ°çš„å½“å‰æ¨¡å—æ‰€åœ¨ç›®å½•ï¼Œæ¨¡å—ä¸Šä¸‹æ–‡
 * */</span>
<span class="token keyword">function</span> <span class="token function">tryExtensions</span><span class="token punctuation">(</span><span class="token parameter">modulePath<span class="token punctuation">,</span> extensions<span class="token punctuation">,</span> originModulePath<span class="token punctuation">,</span> moduleContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¼˜å…ˆå°è¯•ä¸éœ€è¦æ‹“å±•åçš„é€‰é¡¹</span>
  extensions<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> extension <span class="token keyword">of</span> extensions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>modulePath <span class="token operator">+</span> extension<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> modulePath <span class="token operator">+</span> extension
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æœªåŒ¹é…åˆ°å¯¹åº”æ–‡ä»¶</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">No module, Error: Can&#39;t resolve </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>originModulePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> in  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>moduleContext<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬é€šè¿‡<code>fs.existsSync</code>æ£€æŸ¥ä¼ å…¥æ–‡ä»¶ç»“åˆ<code>extensions</code>ä¾æ¬¡éå†å¯»æ‰¾å¯¹åº”åŒ¹é…çš„è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ‰¾åˆ°åˆ™ç›´æ¥è¿”å›ã€‚å¦‚æœæœªæ‰¾åˆ°åˆ™ç»™äºˆç”¨äºä¸€ä¸ªå‹å¥½çš„æç¤ºé”™è¯¯ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„ <code>extensions.unshift(&#39;&#39;);</code>æ˜¯é˜²æ­¢ç”¨æˆ·å¦‚æœå·²ç»ä¼ å…¥äº†åç¼€æ—¶ï¼Œæˆ‘ä»¬ä¼˜å…ˆå°è¯•ç›´æ¥å¯»æ‰¾ï¼Œå¦‚æœå¯ä»¥æ‰¾åˆ°æ–‡ä»¶é‚£ä¹ˆå°±ç›´æ¥è¿”å›ã€‚æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹æ‰ä¼šä¾æ¬¡å°è¯•ã€‚</p></blockquote><h4 id="é€’å½’å¤„ç†" tabindex="-1"><a class="header-anchor" href="#é€’å½’å¤„ç†"><span>é€’å½’å¤„ç†</span></a></h4><p>ç»è¿‡ä¸Šä¸€æ­¥å¤„ç†ï¼Œé’ˆå¯¹å…¥å£æ–‡ä»¶æˆ‘ä»¬è°ƒç”¨<code>buildModule</code>å¯ä»¥å¾—åˆ°è¿™æ ·çš„è¿”å›å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿è¡Œ<code>webpack/core/index.js</code>å¾—åˆ°çš„è¿”å›ç»“æœå§ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\nconst loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\nconst loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘åœ¨<code>buildEntryModule</code>ä¸­æ‰“å°äº†å¤„ç†å®Œæˆåçš„<code>entries</code>å¯¹è±¡ã€‚å¯ä»¥çœ‹åˆ°æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€æœŸå¾…çš„:</p><ul><li><code>id</code>ä¸ºæ¯ä¸ªæ¨¡å—ç›¸å¯¹äºè·Ÿè·¯å¾„çš„æ¨¡å—.(è¿™é‡Œæˆ‘ä»¬é…ç½®çš„<code>context:process.cwd()</code>)ä¸º<code>webpack</code>ç›®å½•ã€‚</li><li><code>dependencies</code>ä¸ºè¯¥æ¨¡å—å†…éƒ¨ä¾èµ–çš„æ¨¡å—ï¼Œè¿™é‡Œç›®å‰è¿˜æ²¡æœ‰æ·»åŠ ã€‚</li><li><code>name</code>ä¸ºè¯¥æ¨¡å—æ‰€å±çš„å…¥å£æ–‡ä»¶åç§°ã€‚</li><li><code>_source</code>ä¸ºè¯¥æ¨¡å—ç¼–è¯‘åçš„æºä»£ç ã€‚</li></ul><p>æ­¤æ—¶æ‰“å¼€<code>src</code>ç›®å½•ä¸ºå…¥å£æ–‡ä»¶æ·»åŠ ä¸€äº›ä¾èµ–å’Œå†…å®¹å§:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// webpack/example/entry1.js</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./demo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 1 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// webpack/example/entry2.js</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./demo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 2 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// webpack/example/demo.js</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&#39;JSH&#39;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶è®©æˆ‘ä»¬é‡æ–°è¿è¡Œ<code>webpack-demo/core/index.js</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OKï¼Œç›®å‰ä¸ºæ­¢é’ˆå¯¹äº<code>entry</code>çš„ç¼–è¯‘å¯ä»¥æš‚æ—¶å‘Šä¸€æ®µè½äº†ã€‚</p><p><strong>æ€»ä¹‹ä¹Ÿå°±æ˜¯ï¼Œè¿™ä¸€æ­¥é€šè¿‡æ–¹æ³•å°†<code>entry</code>è¿›è¡Œåˆ†æç¼–è¯‘åå¾—åˆ°ä¸€ä¸ªå¯¹è±¡ã€‚å°†è¿™ä¸ªå¯¹è±¡æ·»åŠ åˆ°<code>this.entries</code>ä¸­å»ã€‚</strong></p><p>æ¥ä¸‹æ¥å»å¤„ç†ä¾èµ–çš„æ¨¡å—ã€‚</p><p>å…¶å®å¯¹äºä¾èµ–çš„æ¨¡å—æ— éä¹Ÿæ˜¯ç›¸åŒçš„æ­¥éª¤ï¼š</p><ul><li>æ£€æŸ¥å…¥å£æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨ä¾èµ–ã€‚</li><li>å­˜åœ¨ä¾èµ–çš„è¯ï¼Œé€’å½’è°ƒç”¨<code>buildModule</code>æ–¹æ³•ç¼–è¯‘æ¨¡å—ã€‚ä¼ å…¥<code>moduleName</code>ä¸ºå½“å‰æ¨¡å—æ‰€å±çš„å…¥å£æ–‡ä»¶ã€‚<code>modulePath</code>ä¸ºå½“å‰è¢«ä¾èµ–æ¨¡å—çš„ç»å¯¹è·¯å¾„ã€‚</li><li>åŒç†æ£€æŸ¥é€’å½’æ£€æŸ¥è¢«ä¾èµ–çš„æ¨¡å—å†…éƒ¨æ˜¯å¦ä»ç„¶å­˜åœ¨ä¾èµ–ï¼Œå­˜åœ¨çš„è¯é€’å½’ä¾èµ–è¿›è¡Œæ¨¡å—ç¼–è¯‘ã€‚è¿™æ˜¯ä¸€ä¸ª<strong>æ·±åº¦ä¼˜å…ˆ</strong>çš„è¿‡ç¨‹ã€‚</li><li>å°†æ¯ä¸€ä¸ªç¼–è¯‘åçš„æ¨¡å—ä¿å­˜è¿›å…¥<code>this.modules</code>ä¸­å»ã€‚</li></ul><p>æ¥ä¸‹æ¥åªè¦ç¨ç¨åœ¨<code>handleWebpackCompiler</code>æ–¹æ³•ä¸­ç¨ç¨æ”¹åŠ¨å°±å¯ä»¥äº†:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// é€’å½’ä¾èµ–æ·±åº¦éå† å­˜åœ¨ä¾èµ–æ¨¡å—åˆ™åŠ å…¥</span>
module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dependency</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> depModule <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> dependency<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å°†ç¼–è¯‘åçš„ä»»ä½•ä¾èµ–æ¨¡å—å¯¹è±¡åŠ å…¥åˆ°moduleså¯¹è±¡ä¸­å»</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>depModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¯¹äºä¾èµ–çš„æ¨¡å—è¿›è¡Œäº†é€’å½’è°ƒç”¨<code>buildModule</code>,å°†è¾“å‡ºçš„æ¨¡å—å¯¹è±¡æ·»åŠ è¿›å…¥äº†<code>this.modules</code>ä¸­å»ã€‚</p><p>æ­¤æ—¶è®©é‡æ–°è¿è¡Œ<code>webpack/core/index.js</code>è¿›è¡Œç¼–è¯‘ï¼Œè¿™é‡Œåœ¨<code>buildEntryModule</code>ç¼–è¯‘ç»“æŸåæ‰“å°äº†<code>assets</code>å’Œ<code>modules</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token function">buildEntryModule</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entryPath <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryName<span class="token punctuation">]</span>
    <span class="token keyword">const</span> entityObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entryPath<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;entries&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;modules&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
modules Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/demo.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&quot;const name = &#39;JSH&#39;;\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&#39;module.exports = {\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;  name\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;};\\n&#39;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/demo.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&quot;const name = &#39;JSH&#39;;\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&#39;module.exports = {\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;  name\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;};\\n&#39;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°å·²ç»å°†<code>demo.js</code>è¿™ä¸ªä¾èµ–å¦‚æ„¿ä»¥å¿åŠ å…¥åˆ°<code>modules</code>ä¸­äº†ï¼ŒåŒæ—¶å®ƒä¹Ÿç»è¿‡<code>loader</code>çš„å¤„ç†ã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç°å®ƒè¢«é‡å¤åŠ å…¥äº†ä¸¤æ¬¡ã€‚</p><p>è¿™æ˜¯å› ä¸º<strong>demo.js</strong>è¿™ä¸ªæ¨¡å—è¢«å¼•ç”¨äº†ä¸¤æ¬¡ï¼Œå®ƒè¢«<code>entry1</code>å’Œ<code>entry2</code>éƒ½å·²è¿›è¡Œäº†ä¾èµ–ï¼Œåœ¨è¿›è¡Œé€’å½’ç¼–è¯‘æ—¶è¿›è¡Œäº†ä¸¤æ¬¡<code>buildModule</code>ç›¸åŒæ¨¡å—ã€‚</p><p>é‚£ä¹ˆæ¥å¤„ç†ä¸‹è¿™ä¸ªé—®é¢˜ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// ç”Ÿæˆ moduleId - é’ˆå¯¹äºæ ¹è·¯å¾„çš„æ¨¡å—ID æ·»åŠ è¿›å…¥æ–°çš„ä¾èµ–æ¨¡å—è·¯å¾„</span>
<span class="token keyword">const</span> moduleId <span class="token operator">=</span> <span class="token string">&#39;./&#39;</span> <span class="token operator">+</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> absolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// é€šè¿‡ babel ä¿®æ”¹æºä»£ç ä¸­çš„ require å˜æˆ __webpack_require__ è¯­å¥</span>
node<span class="token punctuation">.</span>callee <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;__webpack_require__&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// ä¿®æ”¹æºä»£ç ä¸­ require è¯­å¥å¼•å…¥çš„æ¨¡å— å…¨éƒ¨ä¿®æ”¹é—®ç›¸å¯¹äºæ ¹è·¯å¾„æ¥å¤„ç†</span>
node<span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">// è½¬åŒ–å½“å‰ this.modules ä¸º ids</span>
<span class="token keyword">const</span> alreadyModules <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>alreadyModules<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸ºå½“å‰æ¨¡å—æ·»åŠ  require è¯­å¥é€ æˆçš„ä¾èµ–(å†…å®¹ä¸ºç›¸å¯¹äºæ ¹è·¯å¾„çš„æ¨¡å—ID)</span>
  module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>id <span class="token operator">===</span> moduleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œåœ¨æ¯ä¸€æ¬¡ä»£ç åˆ†æçš„ä¾èµ–è½¬åŒ–ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­<code>this.module</code>å¯¹è±¡æ˜¯å¦å·²ç»å­˜åœ¨å½“å‰æ¨¡å—äº†ï¼ˆé€šè¿‡å”¯ä¸€çš„æ¨¡å—idè·¯å¾„åˆ¤æ–­ï¼‰ã€‚</p><p>å¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ è¿›å…¥ä¾èµ–ä¸­è¿›è¡Œç¼–è¯‘ï¼Œå¦‚æœè¯¥æ¨¡å—å·²ç»å­˜åœ¨è¿‡äº†å°±è¯æ˜è¿™ä¸ªæ¨¡å—å·²ç»è¢«ç¼–è¯‘è¿‡äº†ã€‚æ‰€ä»¥æ­¤æ—¶ä¸éœ€è¦å°†å®ƒå†æ¬¡è¿›è¡Œç¼–è¯‘ï¼Œä»…ä»…éœ€è¦æ›´æ–°è¿™ä¸ªæ¨¡å—æ‰€å±çš„chunkï¼Œä¸ºå®ƒçš„<code>name</code>å±æ€§æ·»åŠ å½“å‰æ‰€å±çš„<code>chunk</code>åç§°ã€‚</p><p>é‡æ–°è¿è¡Œï¼Œå†æ¥çœ‹çœ‹æ‰“å°ç»“æœ:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
modules Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/demo.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;./demo&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&quot;const name = &#39;JSH&#39;;\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&#39;module.exports = {\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;  name\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;};\\n&#39;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶é’ˆå¯¹â€œæ¨¡å—ç¼–è¯‘é˜¶æ®µâ€åŸºæœ¬å·²ç»ç»“æŸäº†ï¼Œè¿™ä¸€æ­¥å¯¹äºæ‰€æœ‰æ¨¡å—ä»å…¥å£æ–‡ä»¶å¼€å§‹è¿›è¡Œåˆ†æã€‚</p><ul><li>ä»å…¥å£å‡ºå‘ï¼Œè¯»å–å…¥å£æ–‡ä»¶å†…å®¹è°ƒç”¨åŒ¹é…<code>loader</code>å¤„ç†å…¥å£æ–‡ä»¶ã€‚</li><li>é€šè¿‡<code>babel</code>åˆ†æä¾èµ–ï¼Œå¹¶ä¸”åŒæ—¶å°†æ‰€æœ‰ä¾èµ–çš„è·¯å¾„æ›´æ¢ä¸ºç›¸å¯¹äºé¡¹ç›®å¯åŠ¨ç›®å½•<code>options.context</code>çš„è·¯å¾„ã€‚</li><li>å…¥å£æ–‡ä»¶ä¸­å¦‚æœå­˜åœ¨ä¾èµ–çš„è¯ï¼Œé€’å½’ä¸Šè¿°æ­¥éª¤ç¼–è¯‘ä¾èµ–æ¨¡å—ã€‚</li><li>å°†æ¯ä¸ªä¾èµ–çš„æ¨¡å—ç¼–è¯‘åçš„å¯¹è±¡åŠ å…¥<code>this.modules</code>ã€‚</li><li>å°†æ¯ä¸ªå…¥å£æ–‡ä»¶ç¼–è¯‘åçš„å¯¹è±¡åŠ å…¥<code>this.entries</code>ã€‚</li></ul><h2 id="ç¼–è¯‘å®Œæˆé˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#ç¼–è¯‘å®Œæˆé˜¶æ®µ"><span>ç¼–è¯‘å®Œæˆé˜¶æ®µ</span></a></h2><p>åœ¨ä¸Šä¸€æ­¥å®Œæˆäº†æ¨¡å—ä¹‹é—´çš„ç¼–è¯‘ï¼Œå¹¶ä¸”ä¸º<code>module</code>å’Œ<code>entry</code>åˆ†åˆ«å¡«å……äº†å†…å®¹ã€‚</p><p>åœ¨å°†æ‰€æœ‰æ¨¡å—é€’å½’ç¼–è¯‘å®Œæˆåï¼Œéœ€è¦<strong>æ ¹æ®ä¸Šè¿°çš„ä¾èµ–å…³ç³»ï¼Œç»„åˆæœ€ç»ˆè¾“å‡ºçš„<code>chunk</code>æ¨¡å—</strong>ã€‚</p><p>ç»§ç»­æ”¹é€ æˆ‘ä»¬çš„<code>Compiler</code>å§:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token function">buildEntryModule</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entryPath <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryName<span class="token punctuation">]</span>
    <span class="token comment">// è°ƒç”¨ buildModule å®ç°çœŸæ­£çš„æ¨¡å—ç¼–è¯‘é€»è¾‘</span>
    <span class="token keyword">const</span> entityObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entryPath<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span>
    <span class="token comment">// æ ¹æ®å½“å‰å…¥å£æ–‡ä»¶å’Œæ¨¡å—çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸ºä¸€ä¸ªä¸ªåŒ…å«å½“å‰å…¥å£æ‰€æœ‰ä¾èµ–æ¨¡å—çš„chunk</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildUpChunk</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entityObj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;entries&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;modules&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;chunks&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

  <span class="token function">buildUpChunk</span><span class="token punctuation">(</span><span class="token parameter">entryName<span class="token punctuation">,</span> entityObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> entryName<span class="token punctuation">,</span> <span class="token comment">// æ¯ä¸€ä¸ªå…¥å£æ–‡ä»¶ä½œä¸ºä¸€ä¸ªchunk</span>
      <span class="token literal-property property">entryModule</span><span class="token operator">:</span> entityObj<span class="token punctuation">,</span>  <span class="token comment">// entryç¼–è¯‘åçš„å¯¹è±¡</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>entryName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å¯»æ‰¾ä¸å½“å‰entryæœ‰å…³çš„æ‰€æœ‰module</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å°†chunkæ·»åŠ åˆ°this.chunksä¸­å»</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæ ¹æ®å¯¹åº”çš„å…¥å£æ–‡ä»¶é€šè¿‡æ¯ä¸€ä¸ªæ¨¡å—(<code>module</code>)çš„<code>name</code>å±æ€§æŸ¥æ‰¾å¯¹åº”å…¥å£çš„æ‰€æœ‰ä¾èµ–æ–‡ä»¶ã€‚</p><p>å…ˆæ¥çœ‹çœ‹<code>this.chunks</code>æœ€ç»ˆä¼šè¾“å‡ºä»€ä¹ˆ:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>chunks Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;main&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entryModule</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token punctuation">[</span>Set<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;second&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entryModule</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ­¥ï¼Œ<strong>å¾—åˆ°äº†<code>Webpack</code>ä¸­æœ€ç»ˆè¾“å‡ºçš„ä¸¤ä¸ª<code>chunk</code></strong>ã€‚</p><p>å®ƒä»¬åˆ†åˆ«æ‹¥æœ‰:</p><ul><li><code>name</code>:å½“å‰å…¥å£æ–‡ä»¶çš„åç§°</li><li><code>entryModule</code>: å…¥å£æ–‡ä»¶ç¼–è¯‘åçš„å¯¹è±¡ã€‚</li><li><code>modules</code>: è¯¥å…¥å£æ–‡ä»¶ä¾èµ–çš„æ‰€æœ‰æ¨¡å—å¯¹è±¡ç»„æˆçš„æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„æ ¼å¼å’Œ<code>entryModule</code>æ˜¯ä¸€è‡´çš„ã€‚</li></ul><p>æ­¤æ—¶ç¼–è¯‘å®Œæˆï¼Œæ‹¼è£…<code>chunk</code>çš„ç¯èŠ‚å°±åœ†æ»¡å®Œæˆã€‚</p><h2 id="è¾“å‡ºæ–‡ä»¶é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#è¾“å‡ºæ–‡ä»¶é˜¶æ®µ"><span>è¾“å‡ºæ–‡ä»¶é˜¶æ®µ</span></a></h2><h3 id="åˆ†æåŸå§‹æ‰“åŒ…è¾“å‡ºç»“æœ" tabindex="-1"><a class="header-anchor" href="#åˆ†æåŸå§‹æ‰“åŒ…è¾“å‡ºç»“æœ"><span>åˆ†æåŸå§‹æ‰“åŒ…è¾“å‡ºç»“æœ</span></a></h3><p>è¿™é‡Œï¼Œæˆ‘æŠŠ<code>webpack-demo/core/index.js</code>ä¸­åšäº†å¦‚ä¸‹ä¿®æ”¹:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token operator">-</span> <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span> <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿ç”¨åŸæœ¬çš„<code>webpack</code>ä»£æ›¿è‡ªå·±å®ç°çš„<code>webpack</code>å…ˆè¿›è¡Œä¸€æ¬¡æ‰“åŒ…ã€‚</p><p>è¿è¡Œ<code>webpack-demo/core/index.js</code>åï¼Œæˆ‘ä»¬ä¼šåœ¨<code>webpack-demo/src/build</code>ä¸­å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶:<code>main.js</code>å’Œ<code>second.js</code>ï¼Œä»¥å…¶ä¸­ä¸€ä¸ª<code>main.js</code>æ¥çœ‹çœ‹å®ƒçš„å†…å®¹:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>

<span class="token doc-comment comment">/***/ &quot;./example/src/demo.js&quot;:
/*!*****************************!*\\
  !*** ./example/src/demo.js ***!
  \\*****************************/</span>
<span class="token doc-comment comment">/***/ ((module) =&gt; <span class="token punctuation">{</span>

const name = &#39;JSH&#39;;

module.exports = <span class="token punctuation">{</span>
  name,
<span class="token punctuation">}</span>;
 const loader2 = &quot;I&#39;m loader2&quot;;
 const loader1 = &quot;I&#39;m loader1&quot;;

/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token doc-comment comment">/******/</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/************************************************************************/</span>
<span class="token doc-comment comment">/******/</span>   <span class="token comment">// The module cache</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">var</span> __webpack_module_cache__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/******/</span>   <span class="token comment">// The require function</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Check if module is in cache</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token doc-comment comment">/******/</span>     <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>    <span class="token punctuation">}</span>
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Create a new module (and put it into the cache)</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">var</span> module <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token doc-comment comment">/******/</span>     <span class="token comment">// no module.id needed</span>
<span class="token doc-comment comment">/******/</span>     <span class="token comment">// no module.loaded needed</span>
<span class="token doc-comment comment">/******/</span>     <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token doc-comment comment">/******/</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Execute the module function</span>
<span class="token doc-comment comment">/******/</span>    __webpack_modules__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Return the exports of the module</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   <span class="token punctuation">}</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/************************************************************************/</span>
<span class="token keyword">var</span> __webpack_exports__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">/*!*******************************!*\\
  !*** ./example/src/entry1.js ***!
  \\*******************************/</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./demo */</span> <span class="token string">&quot;./example/src/demo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 1 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">const</span> loader2 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader2&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> loader1 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/******/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç¨å¾®åˆ†æä¸€ä¸‹åŸå§‹æ‰“åŒ…ç”Ÿæˆçš„ä»£ç ï¼š</p><p><code>webpack</code>æ‰“åŒ…åçš„ä»£ç å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ª<code>__webpack_require__</code>çš„å‡½æ•°ä»£æ›¿äº†<code>NodeJs</code>å†…éƒ¨çš„<code>require</code>æ–¹æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">/*!*******************************!*\\
  !*** ./example/src/entry1.js ***!
  \\*******************************/</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./demo */</span> <span class="token string">&quot;./example/src/demo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 1 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">const</span> loader2 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader2&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> loader1 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/******/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å—ä»£ç ç›¸æ¯”å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰å§ï¼Œè¿™å°±æ˜¯è‡ªå·±ç¼–è¯‘åçš„å…¥å£æ–‡ä»¶ä»£ç ã€‚åŒæ—¶é¡¶éƒ¨çš„ä»£ç æ˜¯è¯¥å…¥å£æ–‡ä»¶ä¾èµ–çš„æ‰€æœ‰æ¨¡å—å®šä¹‰çš„ä¸€ä¸ªå¯¹è±¡:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>

<span class="token doc-comment comment">/***/ &quot;./example/src/demo.js&quot;:
/*!*****************************!*\\
  !*** ./example/src/demo.js ***!
  \\*****************************/</span>
<span class="token doc-comment comment">/***/ ((module) =&gt; <span class="token punctuation">{</span>

const name = &#39;JSH&#39;;

module.exports = <span class="token punctuation">{</span>
  name,
<span class="token punctuation">}</span>;
 const loader2 = &quot;I&#39;m loader2&quot;;
 const loader1 = &quot;I&#39;m loader1&quot;;

/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª<code>__webpack__modules</code>çš„å¯¹è±¡ï¼Œå¯¹è±¡çš„<code>key</code>ä¸ºè¯¥ä¾èµ–æ¨¡å—ç›¸å¯¹äºè·Ÿè·¯å¾„çš„ç›¸å¯¹è·¯å¾„ï¼Œå¯¹è±¡çš„<code>value</code>è¯¥ä¾èµ–æ¨¡å—ç¼–è¯‘åçš„ä»£ç ã€‚</p><h3 id="è¾“å‡ºæ–‡ä»¶é˜¶æ®µ-1" tabindex="-1"><a class="header-anchor" href="#è¾“å‡ºæ–‡ä»¶é˜¶æ®µ-1"><span>è¾“å‡ºæ–‡ä»¶é˜¶æ®µ</span></a></h3><p>æ¥ä¸‹é‡Œåœ¨åˆ†æå®Œ<code>webpack</code>åŸå§‹æ‰“åŒ…åçš„ä»£ç ä¹‹åï¼Œæ¥ç»§ç»­ä¸Šä¸€æ­¥ã€‚é€šè¿‡<code>this.chunks</code>æ¥å°è¯•è¾“å‡ºæœ€ç»ˆçš„æ•ˆæœå§ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// runæ–¹æ³•å¯åŠ¨ç¼–è¯‘, åŒæ—¶runæ–¹æ³•æ¥å—å¤–éƒ¨ä¼ é€’çš„callback</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å½“è°ƒç”¨runæ–¹æ³•æ—¶ï¼Œè§¦å‘å¼€å§‹ç¼–è¯‘çš„plugin</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// è·å–å…¥å£é…ç½®å¯¹è±¡</span>
  <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// ç¼–è¯‘å…¥å£æ–‡ä»¶</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildEntryModule</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
  <span class="token comment">// å¯¼å‡ºåˆ—è¡¨ ä¹‹åå°†æ¯ä¸ªchunkè½¬åŒ–ä¸ºå•ç‹¬çš„æ–‡ä»¶ åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨ this.assets ä¸­</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exportFile</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>buildEntryModule</code>æ¨¡å—ç¼–è¯‘å®Œæˆä¹‹åï¼Œé€šè¿‡<code>this.exportFile</code>æ–¹æ³•å®ç°å¯¼å‡ºæ–‡ä»¶çš„é€»è¾‘ã€‚</p><p>æ¥ä¸€èµ·çœ‹çœ‹<code>this.exportFile</code>æ–¹æ³•:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// å°†chunkåŠ å…¥è¾“å‡ºåˆ—è¡¨ä¸­å»</span>
  <span class="token function">exportFile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>output
    <span class="token comment">// æ ¹æ® chunks ç”Ÿæˆçš„ assets å†…å®¹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> parseFileName <span class="token operator">=</span> output<span class="token punctuation">.</span>filename<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;[name]&#39;</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token comment">// assets ä¸­ { &#39;main.js&#39;: &#39;ä»£ç å­—ç¬¦ä¸²&#39; }</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">[</span>parseFileName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getSourceCode</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
      <span class="token comment">// files ä¸­ä¿å­˜æ‰€æœ‰çš„ç”Ÿæˆæ–‡ä»¶å</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>parseFileName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// è°ƒç”¨ plugin emit é’©å­</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ å­˜åœ¨å°±ç›´æ¥ fs.write ä¸å­˜åœ¨å°±éœ€è¦æ–°å»ºç›®å½•</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å°† assets ä¸­çš„å†…å®¹ç”Ÿæˆæ‰“åŒ…æ–‡ä»¶ å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸­</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fileName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">[</span>fileName<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// ç»“æŸä¹‹å è°ƒç”¨ plugin done é’©å­</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">toJSON</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">entries</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">,</span>
          <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span>
          <span class="token literal-property property">assets</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">,</span>
          <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>exportFile</code>åšäº†å¦‚ä¸‹å‡ ä»¶äº‹:</p><ul><li>é¦–å…ˆè·å–é…ç½®å‚æ•°çš„è¾“å‡ºé…ç½®ï¼Œè¿­ä»£æˆ‘ä»¬çš„<code>this.chunks</code>ï¼Œå°†<code>output.filename</code>ä¸­çš„<code>[name]</code>æ›¿æ¢ç§°ä¸ºå¯¹åº”çš„å…¥å£æ–‡ä»¶åç§°ã€‚åŒæ—¶æ ¹æ®<code>chunks</code>çš„å†…å®¹ä¸º<code>this.assets</code>ä¸­æ·»åŠ éœ€è¦æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹ã€‚</li><li>å°†æ–‡ä»¶å†™å…¥ç£ç›˜å‰è°ƒç”¨<code>plugin</code>çš„<code>emit</code>é’©å­å‡½æ•°ã€‚</li><li>åˆ¤æ–­<code>output.path</code>æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡<code>fs</code>æ–°å»ºè¿™ä¸ªæ–‡ä»¶å¤¹ã€‚</li><li>å°†æœ¬æ¬¡æ‰“åŒ…ç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶å(<code>this.assets</code>çš„<code>key</code>å€¼ç»„æˆçš„æ•°ç»„)å­˜æ”¾è¿›å…¥<code>files</code>ä¸­å»ã€‚</li><li>å¾ªç¯<code>this.assets</code>ï¼Œå°†æ–‡ä»¶ä¾æ¬¡å†™å…¥å¯¹åº”çš„ç£ç›˜ä¸­å»ã€‚</li><li>æ‰€æœ‰æ‰“åŒ…æµç¨‹ç»“æŸï¼Œè§¦å‘<code>webpack</code>æ’ä»¶çš„<code>done</code>é’©å­ã€‚</li><li>åŒæ—¶ä¸º<code>NodeJs Webpack APi</code>å‘¼åº”ï¼Œè°ƒç”¨<code>run</code>æ–¹æ³•ä¸­å¤–éƒ¨ä¼ å…¥çš„<code>callback</code>ä¼ å…¥ä¸¤ä¸ªå‚æ•°ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œ<code>this.assets</code>åšçš„äº‹æƒ…ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯é€šè¿‡åˆ†æ<code>chunks</code>å¾—åˆ°<code>assets</code>ç„¶åè¾“å‡ºå¯¹åº”çš„ä»£ç åˆ°ç£ç›˜ä¸­ã€‚</p><p>ä»”ç»†çœ‹è¿‡ä¸Šè¾¹ä»£ç ï¼Œä¼šå‘ç°<code>this.assets</code>è¿™ä¸ª<code>Map</code>ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„<code>value</code>æ˜¯é€šè¿‡è°ƒç”¨<code>getSourceCode(chunk)</code>æ–¹æ³•æ¥ç”Ÿæˆæ¨¡å—å¯¹åº”çš„ä»£ç çš„ã€‚</p><p>é‚£ä¹ˆ<code>getSourceCode</code>è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•æ ¹æ®<code>chunk</code>æ¥ç”Ÿæˆæœ€ç»ˆç¼–è¯‘åçš„ä»£ç å‘¢ï¼Ÿä¸€èµ·æ¥çœ‹çœ‹å§ï¼</p><h3 id="getsourcecodeæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#getsourcecodeæ–¹æ³•"><span><code>getSourceCode</code>æ–¹æ³•</span></a></h3><p>é¦–å…ˆç®€å•æ˜ç¡®ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„èŒè´£ï¼Œéœ€è¦<code>getSourceCode</code>æ–¹æ³•æ¥å—ä¼ å…¥çš„<code>chunk</code>å¯¹è±¡ã€‚ä»è€Œè¿”å›è¯¥<code>chunk</code>çš„æºä»£ç ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œå…¶å®è¿™é‡Œç”¨äº†ä¸€ä¸ªæ¯”è¾ƒå·æ‡’çš„åŠæ³•ï¼Œä½†æ˜¯å®Œå…¨ä¸å¦¨ç¢ç†è§£<code>Webpack</code>æµç¨‹ï¼Œä¸Šè¾¹åˆ†æè¿‡åŸæœ¬<code>webpack</code>æ‰“åŒ…åçš„ä»£ç <strong>ä»…ä»…åªæœ‰å…¥å£æ–‡ä»¶å’Œæ¨¡å—ä¾èµ–æ˜¯æ¯æ¬¡æ‰“åŒ…ä¸åŒçš„åœ°æ–¹ï¼Œå…³äº<code>require</code>æ–¹æ³•ä¹‹ç±»éƒ½æ˜¯ç›¸é€šçš„</strong>ã€‚</p><p>æŠŠæ¡æ¯æ¬¡çš„ä¸åŒç‚¹ï¼Œç›´æ¥å…ˆæ¥çœ‹çœ‹å®ƒçš„å®ç°æ–¹å¼:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">chunk</span>
 * nameå±æ€§å…¥å£æ–‡ä»¶åç§°
 * entryModuleå…¥å£æ–‡ä»¶moduleå¯¹è±¡
 * modules ä¾èµ–æ¨¡å—è·¯å¾„
 */</span>
<span class="token keyword">function</span> <span class="token function">getSourceCode</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> entryModule<span class="token punctuation">,</span> modules <span class="token punctuation">}</span> <span class="token operator">=</span> chunk<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
(() =&gt; {
var __webpack_modules__ = ({
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span> modules<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>module<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;: ((module) =&gt; {</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>module<span class="token punctuation">.</span>_source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">})</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">).join(&#39;,&#39;) }
 \\t});

 \\tvar __webpack_module_cache__ = {};

 \\tfunction __webpack_require__(moduleId) {
 \\t\\tvar cachedModule = __webpack_module_cache__[moduleId];
 \\t\\tif (cachedModule !== undefined) {
 \\t\\t\\treturn cachedModule.exports;
 \\t\\t}
 \\t\\tvar module = __webpack_module_cache__[moduleId] = {
 \\t\\t\\texports: {}
 \\t\\t};

 \\t\\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);

 \\t\\treturn module.exports;
\\t}

  var __webpack_exports__ = {};
  (() =&gt; {
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span> entryModule<span class="token punctuation">.</span>_source <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  })();

 })()
;
  </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å…¶å®éå¸¸ç®€å•ï¼Œè¿œè¿œæ²¡æœ‰æƒ³è±¡éš¾ï¼æœ‰ç‚¹è¿”ç’å½’çœŸçš„æ„Ÿè§‰æ˜¯å—å“ˆå“ˆã€‚</p><p>åœ¨<code>getSourceCode</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡ç»„åˆè€Œæ¥çš„<code>chunk</code>è·å¾—å¯¹åº”çš„:</p><ul><li><code>name</code>: è¯¥å…¥å£æ–‡ä»¶å¯¹åº”è¾“å‡ºæ–‡ä»¶çš„åç§°ã€‚</li><li><code>entryModule</code>: å­˜æ”¾è¯¥å…¥å£æ–‡ä»¶ç¼–è¯‘åçš„å¯¹è±¡ã€‚</li><li><code>modules</code>:å­˜æ”¾è¯¥å…¥å£æ–‡ä»¶ä¾èµ–çš„æ‰€æœ‰æ¨¡å—çš„å¯¹è±¡ã€‚</li></ul><p><strong>é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼å»å®ç°äº†<code>__webpack__modules</code>å¯¹è±¡ä¸Šçš„å±æ€§ï¼ŒåŒæ—¶ä¹Ÿåœ¨åº•éƒ¨é€šè¿‡<code>\${entryModule._source}</code>æ‹¼æ¥å‡ºå…¥å£æ–‡ä»¶çš„ä»£ç ã€‚</strong></p><blockquote><p>ä¸Šæ–‡æåˆ°è¿‡ä¸ºä»€ä¹ˆè¦å°†æ¨¡å—çš„<code>require</code>æ–¹æ³•çš„è·¯å¾„è½¬åŒ–ä¸ºç›¸å¯¹äºè·Ÿè·¯å¾„(<code>context</code>)çš„è·¯å¾„ï¼Œçœ‹åˆ°è¿™é‡Œç›¸ä¿¡å¤§å®¶éƒ½å·²ç»äº†ç„¶äºèƒ¸äº†ã€‚å› ä¸ºæœ€ç»ˆå®ç°çš„<code>__webpack_require__</code>æ–¹æ³•å…¨éƒ½æ˜¯é’ˆå¯¹äºæ¨¡å—ç›¸å¯¹äºè·Ÿè·¯å¾„çš„ç›¸å¯¹è·¯å¾„å®ç°çš„<code>require</code>æ–¹æ³•ã€‚åŒæ—¶å¦‚æœä¸å¤ªæ¸…æ¥š<code>require</code>æ–¹æ³•æ˜¯å¦‚ä½•è½¬æˆä¸º<code>__webpack_require__</code>æ–¹æ³•ï¼Œå¯ä»¥é‡æ–°å›åˆ°ç¼–è¯‘ç¯èŠ‚é‡æ–°é˜…è¯»ï½é€šè¿‡<code>babel</code>åœ¨<code>AST</code>è½¬åŒ–é˜¶æ®µå°†<code>require</code>æ–¹æ³•è°ƒç”¨å˜æˆäº†<code>__webpack_require__</code>ã€‚</p></blockquote><h1 id="å¤§åŠŸå‘Šæˆ" tabindex="-1"><a class="header-anchor" href="#å¤§åŠŸå‘Šæˆ"><span>å¤§åŠŸå‘Šæˆ</span></a></h1><p>è‡³æ­¤ï¼Œè®©æˆ‘ä»¬å›åˆ°<code>webpack-demo/core/index.js</code>ä¸­å»ã€‚é‡æ–°è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä½ ä¼šå‘ç°<code>webpack-demo/example</code>ç›®å½•ä¸‹ä¼šå¤šå‡ºä¸€ä¸ª<code>build</code>ç›®å½•ã€‚</p><p>åˆ°è¿™å®ç°å±äºæˆ‘ä»¬è‡ªå·±çš„<code>webpack</code>ã€‚</p><p>å®è´¨ä¸Šï¼Œå¯¹äºå®ç°ä¸€ä¸ªç®€å•ç‰ˆçš„<code>webpack</code>æ ¸å¿ƒï¼Œè¿˜æ˜¯å¸Œæœ›å¤§å®¶å¯ä»¥åœ¨ç†è§£å®ƒçš„å·¥ä½œæµçš„åŒæ—¶å½»åº•ç†è§£<code>compiler</code>è¿™ä¸ªå¯¹è±¡ã€‚</p><p>åœ¨ä¹‹åçš„å…³äº<code>webpack</code>ç›¸å…³åº•å±‚å¼€å‘ä¸­ï¼ŒçœŸæ­£åšåˆ°å¯¹äº<code>compiler</code>çš„ç”¨æ³•äº†ç„¶äºèƒ¸ã€‚äº†è§£<code>compiler</code>ä¸Šçš„å„ç§å±æ€§æ˜¯å¦‚ä½•å½±å“åˆ°ç¼–è¯‘æ‰“åŒ…ç»“æœçš„ã€‚</p>`,228);function b(g,y){const t=e("ExternalLinkIcon"),o=e("Mermaid");return l(),i("div",null,[d,n("blockquote",null,[n("p",null,[s("å¯ä»¥æ ¹æ® "),n("a",k,[s("ä»£ç "),p(t)]),s(" ä¸€è¾¹çœ‹ä¸€è¾¹å°è¯•")])]),u(" more "),m,p(o,{id:"mermaid-58",code:"eJxTUFBIL0osyFDwCeICsh2jn3bMfbq8+2nPtKf9Tc+mbohV0NW1c4p+vmfai/UTY0FKFJxAQgrO0c9WLHw6dzqyjDNYxiX66bqeZx0TkGVcwDKu0S/2TX7avuvZtPYnu7fFcgEA9Us2uw=="}),v])}const f=c(r,[["render",b],["__file","index.html.vue"]]),j=JSON.parse('{"path":"/Promotion/Webpack/","title":"æ‰‹å†™Webpack","lang":"zh-CN","frontmatter":{"title":"æ‰‹å†™Webpack","lang":"zh-CN","date":"2022-05-27T15:54:30.000Z","permalink":"/Promotion/Webpack/","isOriginal":true,"sticky":true,"star":true,"category":["Webpack"],"tag":["Webpack"],"description":"å‰è¨€ Webpackåœ¨å‰ç«¯æ„å»ºå·¥å…·ä¸­å¯ä»¥å ªç§°ä¸­æµç ¥æŸ±èˆ¬çš„å­˜åœ¨ï¼Œæ—¥å¸¸ä¸šåŠ¡å¼€å‘ã€å‰ç«¯åŸºå»ºå·¥å…·ã€é«˜çº§å‰ç«¯é¢è¯•...ä»»ä½•åœºæ™¯éƒ½ä¼šå‡ºç°å®ƒçš„èº«å½±ã€‚ ä¹Ÿè®¸å¯¹äºå®ƒçš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šæ„Ÿåˆ°ç–‘æƒ‘ï¼Œæ—¥å¸¸å·¥ä½œä¸­åŸºäºWebpack Plugin/Loaderä¹‹ç±»æŸ¥é˜…APIä»ç„¶ä¸æ˜ç™½å„ä¸ªå‚æ•°çš„å«ä¹‰å’Œåº”ç”¨æ–¹å¼ã€‚å…¶å®è¿™ä¸€åˆ‡åŸå› æœ¬è´¨ä¸Šéƒ½æ˜¯åŸºäºWebpackå·¥ä½œæµæ²¡æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤çŸ¥...","head":[["meta",{"property":"og:url","content":"https://shaohui-jin.github.io/Promotion/Webpack/"}],["meta",{"property":"og:title","content":"æ‰‹å†™Webpack"}],["meta",{"property":"og:description","content":"å‰è¨€ Webpackåœ¨å‰ç«¯æ„å»ºå·¥å…·ä¸­å¯ä»¥å ªç§°ä¸­æµç ¥æŸ±èˆ¬çš„å­˜åœ¨ï¼Œæ—¥å¸¸ä¸šåŠ¡å¼€å‘ã€å‰ç«¯åŸºå»ºå·¥å…·ã€é«˜çº§å‰ç«¯é¢è¯•...ä»»ä½•åœºæ™¯éƒ½ä¼šå‡ºç°å®ƒçš„èº«å½±ã€‚ ä¹Ÿè®¸å¯¹äºå®ƒçš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šæ„Ÿåˆ°ç–‘æƒ‘ï¼Œæ—¥å¸¸å·¥ä½œä¸­åŸºäºWebpack Plugin/Loaderä¹‹ç±»æŸ¥é˜…APIä»ç„¶ä¸æ˜ç™½å„ä¸ªå‚æ•°çš„å«ä¹‰å’Œåº”ç”¨æ–¹å¼ã€‚å…¶å®è¿™ä¸€åˆ‡åŸå› æœ¬è´¨ä¸Šéƒ½æ˜¯åŸºäºWebpackå·¥ä½œæµæ²¡æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤çŸ¥..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://shaohui-jin.github.io/picx-images-hosting/blog/Webpack/fileDirectory.77dbfxn0wu.webp \\" \\" =800x"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-20T15:05:52.000Z"}],["meta",{"property":"article:author","content":"çŸ³æ€œå®‰"}],["meta",{"property":"article:tag","content":"Webpack"}],["meta",{"property":"article:published_time","content":"2022-05-27T15:54:30.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-20T15:05:52.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"æ‰‹å†™Webpack\\",\\"image\\":[\\"https://shaohui-jin.github.io/picx-images-hosting/blog/Webpack/fileDirectory.77dbfxn0wu.webp \\\\\\" \\\\\\" =800x\\"],\\"datePublished\\":\\"2022-05-27T15:54:30.000Z\\",\\"dateModified\\":\\"2025-03-20T15:05:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"çŸ³æ€œå®‰\\",\\"url\\":\\"https://shaohui-jin.github.io\\"}]}"]]},"headers":[{"level":2,"title":"å‰è¨€","slug":"å‰è¨€","link":"#å‰è¨€","children":[]},{"level":2,"title":"å‰ç½®çŸ¥è¯†","slug":"å‰ç½®çŸ¥è¯†","link":"#å‰ç½®çŸ¥è¯†","children":[]},{"level":2,"title":"æµç¨‹æ¢³ç†","slug":"æµç¨‹æ¢³ç†","link":"#æµç¨‹æ¢³ç†","children":[]},{"level":2,"title":"åˆ›å»ºç›®å½•","slug":"åˆ›å»ºç›®å½•","link":"#åˆ›å»ºç›®å½•","children":[]},{"level":2,"title":"åˆå§‹åŒ–å‚æ•°é˜¶æ®µ","slug":"åˆå§‹åŒ–å‚æ•°é˜¶æ®µ","link":"#åˆå§‹åŒ–å‚æ•°é˜¶æ®µ","children":[{"level":3,"title":"Cliå‘½ä»¤è¡Œä¼ é€’å‚æ•°","slug":"cliå‘½ä»¤è¡Œä¼ é€’å‚æ•°","link":"#cliå‘½ä»¤è¡Œä¼ é€’å‚æ•°","children":[]},{"level":3,"title":"webpack.config.jsä¼ é€’å‚æ•°","slug":"webpack-config-jsä¼ é€’å‚æ•°","link":"#webpack-config-jsä¼ é€’å‚æ•°","children":[]},{"level":3,"title":"å®ç°åˆå¹¶å‚æ•°é˜¶æ®µ","slug":"å®ç°åˆå¹¶å‚æ•°é˜¶æ®µ","link":"#å®ç°åˆå¹¶å‚æ•°é˜¶æ®µ","children":[]}]},{"level":2,"title":"ç¼–è¯‘é˜¶æ®µ","slug":"ç¼–è¯‘é˜¶æ®µ","link":"#ç¼–è¯‘é˜¶æ®µ","children":[{"level":3,"title":"åˆ›å»ºcompilerå¯¹è±¡","slug":"åˆ›å»ºcompilerå¯¹è±¡","link":"#åˆ›å»ºcompilerå¯¹è±¡","children":[]},{"level":3,"title":"ç¼–å†™Plugin","slug":"ç¼–å†™plugin","link":"#ç¼–å†™plugin","children":[]},{"level":3,"title":"å¯»æ‰¾entryå…¥å£","slug":"å¯»æ‰¾entryå…¥å£","link":"#å¯»æ‰¾entryå…¥å£","children":[]}]},{"level":2,"title":"æ¨¡å—ç¼–è¯‘é˜¶æ®µ","slug":"æ¨¡å—ç¼–è¯‘é˜¶æ®µ","link":"#æ¨¡å—ç¼–è¯‘é˜¶æ®µ","children":[{"level":3,"title":"æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„åˆ†æå…¥å£æ–‡ä»¶","slug":"æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„åˆ†æå…¥å£æ–‡ä»¶","link":"#æ ¹æ®å…¥å£æ–‡ä»¶è·¯å¾„åˆ†æå…¥å£æ–‡ä»¶","children":[]},{"level":3,"title":"buildModuleæ¨¡å—ç¼–è¯‘æ–¹æ³•","slug":"buildmoduleæ¨¡å—ç¼–è¯‘æ–¹æ³•","link":"#buildmoduleæ¨¡å—ç¼–è¯‘æ–¹æ³•","children":[{"level":4,"title":"è¯»å–æ–‡ä»¶å†…å®¹","slug":"è¯»å–æ–‡ä»¶å†…å®¹","link":"#è¯»å–æ–‡ä»¶å†…å®¹","children":[]},{"level":4,"title":"è°ƒç”¨loaderå¤„ç†åŒ¹é…åç¼€æ–‡ä»¶","slug":"è°ƒç”¨loaderå¤„ç†åŒ¹é…åç¼€æ–‡ä»¶","link":"#è°ƒç”¨loaderå¤„ç†åŒ¹é…åç¼€æ–‡ä»¶","children":[{"level":5,"title":"å®ç°ç®€å•è‡ªå®šä¹‰loader","slug":"å®ç°ç®€å•è‡ªå®šä¹‰loader","link":"#å®ç°ç®€å•è‡ªå®šä¹‰loader","children":[]},{"level":5,"title":"ä½¿ç”¨loaderå¤„ç†æ–‡ä»¶","slug":"ä½¿ç”¨loaderå¤„ç†æ–‡ä»¶","link":"#ä½¿ç”¨loaderå¤„ç†æ–‡ä»¶","children":[]}]},{"level":4,"title":"webpackæ¨¡å—ç¼–è¯‘é˜¶æ®µ","slug":"webpackæ¨¡å—ç¼–è¯‘é˜¶æ®µ","link":"#webpackæ¨¡å—ç¼–è¯‘é˜¶æ®µ","children":[{"level":5,"title":"tryExtensionsæ–¹æ³•å®ç°","slug":"tryextensionsæ–¹æ³•å®ç°","link":"#tryextensionsæ–¹æ³•å®ç°","children":[]}]},{"level":4,"title":"é€’å½’å¤„ç†","slug":"é€’å½’å¤„ç†","link":"#é€’å½’å¤„ç†","children":[]}]}]},{"level":2,"title":"ç¼–è¯‘å®Œæˆé˜¶æ®µ","slug":"ç¼–è¯‘å®Œæˆé˜¶æ®µ","link":"#ç¼–è¯‘å®Œæˆé˜¶æ®µ","children":[]},{"level":2,"title":"è¾“å‡ºæ–‡ä»¶é˜¶æ®µ","slug":"è¾“å‡ºæ–‡ä»¶é˜¶æ®µ","link":"#è¾“å‡ºæ–‡ä»¶é˜¶æ®µ","children":[{"level":3,"title":"åˆ†æåŸå§‹æ‰“åŒ…è¾“å‡ºç»“æœ","slug":"åˆ†æåŸå§‹æ‰“åŒ…è¾“å‡ºç»“æœ","link":"#åˆ†æåŸå§‹æ‰“åŒ…è¾“å‡ºç»“æœ","children":[]},{"level":3,"title":"è¾“å‡ºæ–‡ä»¶é˜¶æ®µ","slug":"è¾“å‡ºæ–‡ä»¶é˜¶æ®µ-1","link":"#è¾“å‡ºæ–‡ä»¶é˜¶æ®µ-1","children":[]},{"level":3,"title":"getSourceCodeæ–¹æ³•","slug":"getsourcecodeæ–¹æ³•","link":"#getsourcecodeæ–¹æ³•","children":[]}]},{"level":1,"title":"å¤§åŠŸå‘Šæˆ","slug":"å¤§åŠŸå‘Šæˆ","link":"#å¤§åŠŸå‘Šæˆ","children":[]}],"git":{"createdTime":1742483152000,"updatedTime":1742483152000,"contributors":[{"name":"shaohui_jin","email":"1051131737@qq.com","commits":1}]},"readingTime":{"minutes":36.22,"words":10865},"filePathRelative":"zh/å‹æƒ…æ¨å¹¿/Webpack.md","localizedDate":"2022å¹´5æœˆ27æ—¥","excerpt":"<h2>å‰è¨€</h2>\\n<p><code>Webpack</code>åœ¨å‰ç«¯æ„å»ºå·¥å…·ä¸­å¯ä»¥å ªç§°ä¸­æµç ¥æŸ±èˆ¬çš„å­˜åœ¨ï¼Œæ—¥å¸¸ä¸šåŠ¡å¼€å‘ã€å‰ç«¯åŸºå»ºå·¥å…·ã€é«˜çº§å‰ç«¯é¢è¯•...ä»»ä½•åœºæ™¯éƒ½ä¼šå‡ºç°å®ƒçš„èº«å½±ã€‚</p>\\n<p>ä¹Ÿè®¸å¯¹äºå®ƒçš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šæ„Ÿåˆ°ç–‘æƒ‘ï¼Œæ—¥å¸¸å·¥ä½œä¸­åŸºäº<code>Webpack Plugin/Loader</code>ä¹‹ç±»æŸ¥é˜…<code>API</code>ä»ç„¶ä¸æ˜ç™½å„ä¸ªå‚æ•°çš„å«ä¹‰å’Œåº”ç”¨æ–¹å¼ã€‚å…¶å®è¿™ä¸€åˆ‡åŸå› æœ¬è´¨ä¸Šéƒ½æ˜¯åŸºäº<code>Webpack</code>å·¥ä½œæµæ²¡æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤çŸ¥å¯¼è‡´äº†æ‰€è°“çš„â€œé¢å¯¹<code>API</code>æ— ä»ä¸‹æ‰‹â€å¼€å‘ã€‚</p>\\n<p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¼šä»å¦‚ä½•å®ç° <strong>æ¨¡å—åˆ†æé¡¹ç›®æ‰“åŒ…</strong> çš„è§’åº¦å‡ºå‘ï¼Œä½¿ç”¨ <strong>æœ€é€šä¿—ï¼Œæœ€ç®€æ´ï¼Œæœ€æ˜äº†</strong> çš„ä»£ç å¸¦ä½ æ­å¼€<code>Webpack</code>èƒŒåçš„ç¥ç§˜é¢çº±ï¼Œå¸¦ä½ å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆ<code>Webpack</code>ï¼Œä»æ­¤å¯¹äºä»»ä½•<code>webpack</code>ç›¸å…³åº•å±‚å¼€å‘äº†ç„¶äºèƒ¸ã€‚ç”¨æœ€é€šä¿—æ˜“æ‡‚çš„ä»£ç å¸¦ä½ èµ°è¿›<code>webpack</code>çš„å·¥ä½œæµã€‚</p>\\n<blockquote>\\n<p>å¯ä»¥æ ¹æ® <a href=\\"https://gitee.com/jin-shaohui/webpack-demo\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">ä»£ç </a> ä¸€è¾¹çœ‹ä¸€è¾¹å°è¯•</p>\\n</blockquote>\\n","autoDesc":true}');export{f as comp,j as data};
